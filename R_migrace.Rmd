---
title: "MIGRACE DAT - DEMUS / MUSEION"
subtitle: "Narodni Muzeum - Sbirka Muzea Delnickeho hnuti"
author: "Kateřina Křížová"
date: "2023-01-26"
output:
  pdf_document:
    toc: true
    toc_depth: 2
    number_sections: false
    fig_caption: true
  fontsize: 11pt
  geometry: margin=1in

---

\newpage 

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, message=FALSE, fig.dim = c(8, 4))

# PACKAGES

# install.packages("tidyverse", dependencies = T)
# install.packages("readxl")
# install.packages("stringr") # ::str_split_fixed
require(tidyverse)
require(readxl)
require(stringr) # ::str_pad

```

\newpage 

# PROJEKT A CESTY

Narodni muzeum  
Sbirka Muzea Delnickeho hnuti

Maska inventarniho cisla:

\{S\}_\{\#\#\#\#\#\#\}/\{x\}  

S = inventarni rada
\# = cislice
x = podlomeni


```{r PROJECT SPECIFICATIONS AND PATHS, echo = T}

# *** SWITCH *** SWITCH *** SWITCH *** SWITCH *** SWITCH ***

project <- "MDH"

sbirka <- "HM"
podsbirka <- "H11"

# *** SWITCH *** SWITCH *** SWITCH *** SWITCH *** SWITCH ***

path <- "C:/Users/krizova/Documents/R/"

path_data <- paste0(path, "data/")
path_csv <- paste0(path, "mus_csv/", project, "/")

```


# PREPROCESSING A UŽITEČNÉ PŘÍKAZY

## Referenční tabulka *Sbirky*

Není určena k editaci, pouze k filtraci vazeb pro tvorbu slovníků.  


```{r LOAD REFERENCE TABLE SBIRKY}

sbirky <- read_excel(paste0(path_data, "Sbirky.xlsx"))

# sbirky <- sbirky %>% 
#   select(Fond_S, Skupina_S) %>% 
#   distinct() %>% 
#   na.omit()

```


## Užitečné příkazy

```{r REMOVE ALL WORKING LAYERS, warning=F}

rm(demus_tab)
rm(modify_tab)
rm(mus_tab)
```

```{r SPLIT STRING, warning=F}

# # Split name column into firstname and last name
# df[c('First Name', 'Last Name')] <- str_split_fixed(df$Name, ' ', 2)
#  
# # Rearrange columns and remove original name column
# df <- df[c('First Name', 'Last Name', 'State')]

```


\newpage

# 1. PŘÍRŮSTKOVÁ KNIHA

\newpage

# 2. SLOVNÍKY

## Fondy

**DEMUS**: Fondy  
**MUSEION**: csv_fond.csv  
  
**IMPORTNÍ ROZHRANNÍ**: CSV Fond  
 

```{r LOAD AND MODIFY TABLE FONDY}

demus_tab <- read_excel(paste0(path_data, "Fondy.xlsx"))
demus_tab[is.na(demus_tab)] <- ""

# n = 4

modify_tab <- demus_tab %>% 
  mutate(MEMPTY = "") %>% 
  mutate('1sbirkaCisloEvidInt' = sbirka) %>% 
  mutate('2podsbirkaCislo' = podsbirka)

# n = 17

# create CSV

mus_tab <- modify_tab %>% 
  select(
    '1sbirkaCisloEvidInt' = '1sbirkaCisloEvidInt', '2podsbirkaCislo'= '2podsbirkaCislo',
    '3fondKod' = MFOND, '4nazev'= Fond_FN,
    '5poznamka' = Pozn_FN, '6popisPubl'= MEMPTY,
    '7poradi' = MEMPTY, '8oaiId'= MEMPTY,
    '9oaiDatumHarvestingu'= MEMPTY, '10oaiDatumModifikace' = MEMPTY)

write.table(mus_tab, paste0(path_csv, "csv_fond.csv"), 
            sep = ";", quote = F, row.names = F, 
            na = "", fileEncoding="cp1250")

oper_fondy <- mus_tab

```


## Skupiny

**DEMUS**: Skupiny  
**MUSEION**: csv_skupiny.csv

**IMPORTNÍ ROZHRANNÍ**: CSV Skupiny


```{r PREPROCESSING SKUPINY}

fond_skup <- merge(oper_fondy, sbirky, by.x = "4nazev", by.y = "Fond_S") %>% 
  select("3fondKod", "Skupina_S")

```


```{r LOAD AND MODIFY TABLE SKUPINY}

demus_tab <- read_excel(paste0(path_data, "Skupiny.xlsx"))
demus_tab[is.na(demus_tab)] <- ""

# n = 10

modify_tab <- merge(fond_skup, demus_tab, 
                    by.x = "Skupina_S", by.y = "Skup_SK", all.x = T) %>% 
  mutate(MEMPTY = "") %>% 
  mutate('1sbirkaCisloEvidInt' = sbirka) %>% 
  mutate('2podsbirkaCislo' = podsbirka) %>% 
  mutate('5nazev' = case_when(Slovy_SK == "" ~ Skupina_S, 
                              TRUE ~ Slovy_SK)) %>% 
  distinct() %>% 
  na.omit()

# create CSV

mus_tab <- modify_tab %>% 
  select(
    '1sbirkaCisloEvidInt' = '1sbirkaCisloEvidInt', # !! povinny !!
    '2podsbirkaCislo'= '2podsbirkaCislo',          # !! povinny !!
    '3fondKod' ='3fondKod',                        # !! povinny !!
    '4skupinaKod'= Skupina_S,                      # !! povinny !!
    '5nazev' = '5nazev',                           # !! povinny !!
    '6poznamka'= MEMPTY,
    '7popisPubli' = MEMPTY, '8poradi'= MEMPTY,
    '9oaiId'= MEMPTY, '10oaiDatumHarvestingu'= MEMPTY, 
    '11oaiDatumModifikace' = MEMPTY)

write.table(mus_tab, paste0(path_csv, "csv_skupiny.csv"), 
            sep = ";", quote = F, row.names = F, 
            na = "", fileEncoding="cp1250")

oper_skupiny <- mus_tab

```

## Adresář

**DEMUS**: Adresar  
**MUSEION**: csv_adresar.csv

**IMPORTNÍ ROZHRANNÍ**: CSV Adresář osob


```{r LOAD AND MODIFY TABLE ADRESAR}

demus_tab <- read_excel(paste0(path_data, "Adresar.xlsx"))
demus_tab[is.na(demus_tab)] <- ""

# n = 

modify_tab <- demus_tab %>% 
  mutate(MEMPTY = "") %>% 
  mutate('1typSubjektuKod' = "OO") %>% 
  mutate('2subjektKod' = paste(Prijmeni_A, Jmeno_A)) %>% 
  mutate('10osobaPohlavi' = "neznámé") %>% 
  mutate('18subjektStatKod' = "CZ")

# create CSV

mus_tab <- modify_tab %>% 
  select('1typSubjektuKod' = '1typSubjektuKod', '2subjektKod' = '2subjektKod', 
         '3subjektAlterKod' = MEMPTY, '4osobaJmenoPrvni'= Jmeno_A, 
         '5osobaJmenoDruhe' = MEMPTY, '6osobaPrijmeni' = Prijmeni_A, 
         '7osobaTitulPredJmenem' = TitPred_A, '8osobaTitulZaJmenem' = TitZa_A, 
         '9osobaRodnePrijmeni' = MEMPTY, '10osobaPohlavi' = '10osobaPohlavi',  
         '11osobaDatumNarozeni' = MEMPTY, '12osobaMistoNarozeni' =MEMPTY,
         '13okresNarozeniNazev' = MEMPTY, '14obecNarozeniNazev' = MEMPTY,
         '15statNarozeniKod' = MEMPTY, '16osobaDatumUmrti' = MEMPTY,
         '17osobaMistoUmrti' = MEMPTY, '18subjektStatKod' = '18subjektStatKod',
         '19kontaktEmail' = MEMPTY, '20kontaktMobil' = MEMPTY,
         '21kontaktMobil2' = MEMPTY, '22kontaktTelefon' = MEMPTY,
         '23kontaktInternet' = MEMPTY, '24kontaktInternetoveVolani' = MEMPTY,
         '25adresaText' = MEMPTY, '26kontaktniAdresaText' = MEMPTY,
         '27fyzickaOsobaRodneCislo' = MEMPTY, '28subjektPoznamka' = MEMPTY,
         '29AdresaTextoveOkres' = MEMPTY, '30AdresaTextoveObec' = MEMPTY,
         '31AdresaTextoveCastObce' = MEMPTY, '32AdresaTextoveMestskaCast' = MEMPTY,
         '33AdresaTextoveUlice' = MEMPTY, '34AdresaTextoveCisloOrientacni' = MEMPTY,
         '35AdresaTextoveCislo' = MEMPTY, '36AdresaTextovePSC' = MEMPTY,
         '37zamestnanecCislo' = MEMPTY, '38oddeleniKod' = MEMPTY,
         '39osobnostMedailon' = MEMPTY, '40osobnostPseudonym' = MEMPTY,
         '41okruhSubjektuNazev' = MEMPTY, '42subjektSbirka' =  MEMPTY,           
         '43subjektPodsbirka' =  MEMPTY, '44osobaStudia' = MEMPTY,
         '45osobaSpolky' = MEMPTY, '46osobaOsobnost' = MEMPTY,
         '47subjektDatumOd' = MEMPTY, '48subjektDatumDo' = MEMPTY,
         '49kontaktEmail2' = MEMPTY, 
         '50text1' = MEMPTY, '51text2' = MEMPTY, '52text3' = MEMPTY, 
         '53role1' = MEMPTY, '54role2' = MEMPTY, 
         '55role3' = MEMPTY, '56role4' = MEMPTY, '57$role5' = MEMPTY)

write.table(mus_tab, paste0(path_csv, "csv_adresar.csv"), 
            sep = ";", quote = F, row.names = F, 
            na = "", fileEncoding="cp1250")

oper_material <- mus_tab

```

## OO / PO

```{r LOAD TABLE OSOBNOSTI}

demus_tab <- read_excel(paste0(path_data, "Osobnosti.xlsx"))
demus_tab[is.na(demus_tab)] <- ""

# n = 266

```
 
 
```{r CVICNE ZPRACOVANI JMEN}

osoby <- demus_tab %>% 
  select(-MTYPOSOSBY, -MPRIJM, -MKODOS, -MDRJMENO, -MJMENO, -MTITULPRED) %>% 
  mutate(MPRIJM = "") %>% 
  mutate(MJMENO = "") %>% 
  mutate(MDRJMENO = "") 
# %>% 
#   filter(str_detect(Jmeno_OS, ','))

osoby[c("MPRIJM", "MJMENO", "MDRJMENO")] <- str_split_fixed(osoby$Jmeno_OS, ',', 3)


```
 
 
### OO

**DEMUS**: Osobnosti  
**MUSEION**: csv_oo.csv

**IMPORTNÍ ROZHRANNÍ**: CSV Adresář osob

```{r OSOBNOSTI OO}

# filter 

modify_tab <- demus_tab %>% 
  filter(MTYPOSOSBY == "OO") %>% 
  mutate(MKODOS = paste(MPRIJM, MJMENO)) %>% 
  mutate(MEMPTY = "") %>% 
  mutate('10osobaPohlavi' = "neznámé") %>% 
   # mutate('18subjektStatKod' = "CZ") %>% 
  mutate('42subjektSbirka' = sbirka) %>% 
  mutate('43subjektPodsbirka' = podsbirka) 

# n = 249

# create CSV

mus_tab <- modify_tab %>% 
  select('1typSubjektuKod' = MTYPOSOSBY, '2subjektKod' = MKODOS, 
         '3subjektAlterKod' = MEMPTY, '4osobaJmenoPrvni'= MJMENO, 
         '5osobaJmenoDruhe' = MDRJMENO, '6osobaPrijmeni' = MEMPTY, 
         '7osobaTitulPredJmenem' = MTITULPRED, '8osobaTitulZaJmenem' = MEMPTY, 
         '9osobaRodnePrijmeni' = MEMPTY, 
         
         '10osobaPohlavi' = '10osobaPohlavi',   # ENTER MANUALLY  
         
         '11osobaDatumNarozeni' = DatNar_OS, '12osobaMistoNarozeni' = MistoNar_OS,
         '13okresNarozeniNazev' = MEMPTY, '14obecNarozeniNazev' = MEMPTY,
         '15statNarozeniKod' = MEMPTY, '16osobaDatumUmrti' = DatUmr_OS,
         '17osobaMistoUmrti' = MistoUmr_OS, '18subjektStatKod' = MEMPTY,
         '19kontaktEmail' = MEMPTY, '20kontaktMobil' = MEMPTY,
         '21kontaktMobil2' = MEMPTY, '22kontaktTelefon' = MEMPTY,
         '23kontaktInternet' = MEMPTY, '24kontaktInternetoveVolani' = MEMPTY,
         '25adresaText' = MEMPTY, '26kontaktniAdresaText' = MEMPTY,
         '27fyzickaOsobaRodneCislo' = MEMPTY, '28subjektPoznamka' = MEMPTY,
         '29AdresaTextoveOkres' = MEMPTY, '30AdresaTextoveObec' = MEMPTY,
         '31AdresaTextoveCastObce' = MEMPTY, '32AdresaTextoveMestskaCast' = MEMPTY,
         '33AdresaTextoveUlice' = MEMPTY, '34AdresaTextoveCisloOrientacni' = MEMPTY,
         '35AdresaTextoveCislo' = MEMPTY, '36AdresaTextovePSC' = MEMPTY,
         '37zamestnanecCislo' = MEMPTY, '38oddeleniKod' = MEMPTY,
         '39osobnostMedailon' = Medailon_OS, '40osobnostPseudonym' = MEMPTY,
         '41okruhSubjektuNazev' = MEMPTY, 
         
         '42subjektSbirka' = '42subjektSbirka',           # ENTER MANUALLY 
         '43subjektPodsbirka' = '43subjektPodsbirka',     # ENTER MANUALLY 
         
         '44osobaStudia' = MEMPTY,
         '45osobaSpolky' = MEMPTY, '46osobaOsobnost' = MEMPTY,
         '47subjektDatumOd' = MEMPTY, '48subjektDatumDo' = MEMPTY,
         '49kontaktEmail2' = MEMPTY, 
         '50text1' = MEMPTY, '51text2' = MEMPTY, '52text3' = MEMPTY, 
         '53role1' = MEMPTY, '54role2' = MEMPTY, 
         '55role3' = MEMPTY, '56role4' = MEMPTY, '57$role5' = MEMPTY)

write.table(mus_tab, paste0(path_csv, "csv_oo.csv"), 
            sep = ";", quote = F, row.names = F, 
            na = "", fileEncoding="cp1250") 

oper_oo <- mus_tab

```


### PO

**DEMUS**: Osobnosti  
**MUSEION**: csv_po.csv

**IMPORTNÍ ROZHRANNÍ**: CSV Adresář právnických osob


```{r OSOBNOSTI PO}

# filter 

modify_tab <- demus_tab %>% 
  filter(MTYPOSOSBY == "PO") %>% 
  mutate(MEMPTY = "") %>% 
  mutate('26subjektSbirka' = sbirka) %>% 
  mutate('27subjektPodsbirka' = podsbirka)

# n = 17

# create CSV

mus_tab <- modify_tab %>% 
  select(
    '1subjektKod' = Jmeno_OS, '2subjektAlterKod'= MEMPTY,
    '3pravnickaOsobaNazev' = Jmeno_OS, '4pravnickaOsobaIC'= MEMPTY,
    '5pravnickaOsobaDIC' = MEMPTY, '6pravnickaOsobaZapsan'= MEMPTY,
    '7pravnickaOsobaFOP' = MEMPTY, '8subjektStatKod'= MEMPTY,
    '9kontaktEmail' = MEMPTY, '10kontaktMobil'= MEMPTY,
    '11kontaktMobil2' = MEMPTY, '12kontaktTelefon'= MEMPTY,
    '13kontaktInternet' = MEMPTY, '14kontaktInternetoveVolani'= MEMPTY,
    '15adresaText' = MEMPTY, '16kontaktniAdresaText'= MEMPTY,
    '17subjektPoznamka' = MEMPTY, '18AdresaTextoveOkres'= MEMPTY,
    '19AdresaTextoveObec' = MEMPTY, '20AdresaTextoveCastObce'= MEMPTY,
    '21AdresaTextoveMestskaCast' = MEMPTY, '22AdresaTextoveUlice'= MEMPTY,
    '23AdresaTextoveCisloOrientacni' = MEMPTY, '24AdresaTextoveCislo'= MEMPTY,
    '25AdresaTextovePSC' = MEMPTY,  '26subjektSbirka'= '26subjektSbirka',           
    '27subjektPodsbirka' = '27subjektPodsbirka', '28subjektDatumOd'= MEMPTY,
    '29subjektDatumDo' = MEMPTY, '30subjektMedailon'= Medailon_OS,
    '31okruhSubjektuNazev' = MEMPTY, '32kontaktEmail2'= MEMPTY,
    '33text1' = MEMPTY, '34text2'= MEMPTY,'35text3' = MEMPTY, 
    '36role1'= MEMPTY, '37role2' = MEMPTY, '38role3'= MEMPTY,
    '39role4' = MEMPTY, '40role5'= MEMPTY)

write.table(mus_tab, paste0(path_csv, "csv_po.csv"), 
            sep = ";", quote = F, row.names = F, 
            na = "", fileEncoding="cp1250")

oper_po <- mus_tab

```


## Lokality

**DEMUS**: Lokality  
**MUSEION**: csv_lokalita.csv

**IMPORTNÍ ROZHRANNÍ**: CSV Lokalita

```{r LOAD AND MODIFY TABLE LOKALITY}

demus_tab <- read_excel(paste0(path_data, "Lokality.xlsx"))
demus_tab[is.na(demus_tab)] <- ""

# n = 12

modify_tab <- demus_tab %>% 
  mutate(MEMPTY = "")

# create CSV

mus_tab <- modify_tab %>% 
  select(
    '1lokalitaNazev' = Lokalita_L, '2okresNazev'= MEMPTY,
    '3statKod' = MEMPTY, '4oblastNazev'= MEMPTY,
    '5lokalitaZeme' = MEMPTY, '6lokalitaCtverec'= MEMPTY,
    '7lokalitaMapa' = MEMPTY, '8lokalitaZemepisnaSirka'= MEMPTY,
    '9lokalitaZemepisnaDelka'= MEMPTY, '10lokalitaNadmorskaVyska'= MEMPTY,
    '11lokalitaPoznamka'= MEMPTY, '12lokalitaSbirka'= MEMPTY,
    '13lokalitaPodsbirka'= MEMPTY, '14fytochorion1'= MEMPTY,
    '15lokalitaPublicNadNazev'= MEMPTY, '16lokalitaPublicNazev'= MEMPTY,
    '17fytochorion2'= MEMPTY, '18fytochorion3'= MEMPTY,
    '19fytochorion4'= MEMPTY)

write.table(mus_tab, paste0(path_csv, "csv_lokalita.csv"), 
            sep = ";", quote = F, row.names = F, 
            na = "", fileEncoding="cp1250")

oper_lokalita <- mus_tab

```



## Materiály

**DEMUS**: Materialy  
**MUSEION**: csv_material.csv

**IMPORTNÍ ROZHRANNÍ**: CSV Materiál

```{r LOAD AND MODIFY TABLE MATERIALY}

demus_tab <- read_excel(paste0(path_data, "Materialy.xlsx"))
demus_tab[is.na(demus_tab)] <- ""

# n = 67

modify_tab <- demus_tab %>% 
  mutate(MEMPTY = "") %>% 
  mutate('1sbirkaCisloEvidInt' = sbirka) %>% 
  mutate('2podsbirkaCislo' = podsbirka)

# create CSV

mus_tab <- modify_tab %>% 
  select(
    '1sbirkaCisloEvidInt' = '1sbirkaCisloEvidInt', '2podsbirkaCislo'= '2podsbirkaCislo',
    '3materialovaSkupinaKod' = MEMPTY, '4materialNazev'= Material_MA,
    '5materialPoznamka' = Pozn_MA, '6materialPublicNadNazev'= MEMPTY,
    '7materialPublicNazev' = MEMPTY, '8materialNazevAnglicky'= MEMPTY,
    '9materialNazevNemecky'= MEMPTY)

write.table(mus_tab, paste0(path_csv, "csv_material.csv"), 
            sep = ";", quote = F, row.names = F, 
            na = "", fileEncoding="cp1250")

oper_material <- mus_tab

```


## Techniky

**DEMUS**: Techniky  
**MUSEION**: csv_technika.csv

**IMPORTNÍ ROZHRANNÍ**: CSV Technika 

```{r LOAD AND MODIFY TABLE TECHNIKY}

demus_tab <- read_excel(paste0(path_data, "Techniky.xlsx"))
demus_tab[is.na(demus_tab)] <- ""

# n = ?

modify_tab <- demus_tab %>% 
  mutate(MEMPTY = "") %>% 
  mutate('1sbirkaCisloEvidInt' = sbirka) %>% 
  mutate('2podsbirkaCislo' = podsbirka)

# create CSV

mus_tab <- modify_tab %>% 
  select(
    '1sbirkaCisloEvidInt' = '1sbirkaCisloEvidInt', '2podsbirkaCislo'= '2podsbirkaCislo', 
    '3materialovaSkupinaKod' = MEMPTY, '4technikaNazev'= Technika_TE,
    '5technikaPoznamka' = Pozn_TE, '6technikaPublicNadNazev'= MEMPTY,
    '7technikaPublicNazev' = MEMPTY, '8technikaNazevAnglicky'= MEMPTY,
    '9technikaNazevNemecky'= MEMPTY)

write.table(mus_tab, paste0(path_csv, "csv_technika.csv"), 
            sep = ";", quote = F, row.names = F, 
            na = "", fileEncoding="cp1250")

oper_technika <- mus_tab

```


\newpage

# 3. PŘEDMĚTY

OBP = obecný předmět  
PAR = archeologie  
VUM = výtvarné umění  
FOT = fotografická karta  
BIO = přírodovědná  
BR  = ?  

```{r LOAD TABLE SBIRKY}

demus_tab <- read_excel(paste0(path_data, "Sbirky.xlsx")) 

# n = 1087

```

```{r CREATE INVENTORY NUMBER}

demus_tab <- demus_tab %>% 
  
  select(-MSUBOD, -MSUBDO, -MINVC, -MINVCDO) %>%    # get rid of .accdb columns
  
  mutate(MPORC = str_pad(PorC_S, 6, pad = "0")) %>% 
  mutate(MPORCDO = str_pad(HPorC_S, 6, pad = "0"))  %>% 
  mutate(MSUB = ifelse(Lomeni_S == "_", NA, Lomeni_S)) %>% 
  mutate(MSUBDO = HLomeni_S) %>% 
  mutate(MINVC = case_when(is.na(MSUB) ~ paste0(Rada_S, "_", MPORC),
                             TRUE ~ paste0(Rada_S, "_", MPORC, "/", MSUB))) %>% 
  mutate(MINVCDO = case_when(is.na(MSUBDO) ~ "",
                             TRUE ~ paste0(Rada_S, "_", MPORCDO, "/", MSUBDO))) %>% 
  select(-MPORC, -MPORCDO) %>%
  relocate(MINVC, .before = JineC_S) %>% 
  relocate(MINVCDO, .after = MINVC) 

```


## OBP

**DEMUS**: Sbirky 
**MUSEION**: csv_obp.csv

**IMPORTNÍ ROZHRANNÍ**: CSV OBP


```{r MODIFY TABLE SBIRKY FOR OBP}

modify_tab <- demus_tab %>% 
  mutate(MEMPTY = "") %>% 
  mutate('1typPredmetuKod' = "P")   %>% # povinný - "P", "NU", "MI", "HM", "DI", "F1"
  mutate('2sbirkaCisloEvidInt' = sbirka) %>% 
  mutate('3podsbirkaCislo' = podsbirka) %>% 
  mutate('16fondKod' = case_when(
    Fond_S == "Filatelie a pohlednice" ~ "FP",
    Fond_S == "Military" ~ "M",
    Fond_S == "Plakáty" ~ "P",
    Fond_S == "Výtvarné umění" ~ "VU"
    ))
# datumova policka
  
# n = 1087

# create CSV

mus_tab <- modify_tab %>% 
  select(
    '1typPredmetuKod' = '1typPredmetuKod', '2sbirkaCisloEvidInt'= '2sbirkaCisloEvidInt',
    '3podsbirkaCislo' = '3podsbirkaCislo', '4ciselnaRadaKod'= Rada_S,
    
    '5SPCislo' = MINVC, '6SPPoradoveCislo'= PorC_S, '7SPPoradoveCisloSub' = MSUB,
    '8SPCisloDo'= MINVCDO, '9SPPoradoveCisloDo'= HPorC_S, '10SPPoradoveCisloSubDo' = MSUBDO,
    
    '11SPDatumZapisu' = DatZap_S, '12cisloCES' = MEMPTY,
    '13prirustekCislo' = Plus2T_S,'14ciselnaRadaPrirustkuKod' = MEMPTY,
    '15nabytiPrirustkuDatum' =  MEMPTY,'16fondKod' = '16fondKod',
    '17skupinaKod' = Skupina_S,
    '18podskupina1Kod' = MEMPTY, '19podskupina2Kod' = MEMPTY,'20podskupina3Kod' = MEMPTY,
    '21SPPocetKusu' = Pocet_S,'22jinaEvidence1Cislo' = MEMPTY,
    '23jinaEvidence2Cislo' = MEMPTY,'24jinaEvidence3Cislo' = JineC_S,
    '25SPPapirovaKarta' = Karta_S,'26SPKartaJeOpsana' = Opsana_S, # LOGICKE SLOUPCE
    '27archivalie' = Archiv_S,
    '28SPUIns' = Zapsal_S, '29SPDIns' = DatZap_S, # ZALOZENI ZAZNAMU
    '30SPUUpd' = MEMPTY, '31SPDUpd' = DatZm_S, # UPRAVA ZAZNAMU 
    '32stalaLokaceKod' = StLokace_S, '33aktualniLokaceKod' = AktLokace_S, # LOKACE
    '34predmetNazev' = Titul_S, '35oznaceni1Nazev' = Predmet_S, # PREDMET
    '36odborneUrceniPopis' = Popis_S, '37odborneUrceniPopis2' = MEMPTY, 
    '38odborneUrceniPoznamka' = MEMPTY, '39kompletnostKod' = MEMPTY,
    '40signatura' = Sign_S, '41signatura2' = MEMPTY, '42markant' = Markant_S,
    '43jazykSlovy' = MEMPTY,'44urcilOsobaKod' = Urcil_S,
    '45dataceUrceniHodnota' = DatUrc_S, '46odborneUrceniSchvaleno' = MEMPTY,
    '47schvalilOsobaKod' = MEMPTY,'48datumSchvaleni' = MEMPTY,
    '49SPPoznamka' = MEMPTY, '50SPKlicovaSlova' = MEMPTY,
    '51pojistnaCena' = MEMPTY, '52pojistnaCenaMena' = MEMPTY, # POJISTENI 
    '53pojistnaCenaDatum' = MEMPTY,'54ucetniCena' = MEMPTY, # CENA
    '55SPDatumPosledniManipulace' = MEMPTY,
    '56text1' = MEMPTY, '57text2' = MEMPTY, '58text3' = MEMPTY,
    '59text4' = MEMPTY,'60text5' = MEMPTY, '61text6' = MEMPTY,
    '62text7' = MEMPTY, '63text8' = MEMPTY,'64text9' = MEMPTY,
    '65text10' = MEMPTY,'66priznak1' = MEMPTY, '67priznak2' = MEMPTY,
    '68priznak3' = MEMPTY, '69priznak4' = MEMPTY,'70priznak5' = MEMPTY,
    '71zpusobNabytiKod' = MEMPTY,'72nabytiPredmetuDatum' = MEMPTY, # NABYTI
    '73nabytiPredmetuRokAkvizice' = MEMPTY,'74nabytiPredmetuDoklad' = MEMPTY,
    '75nabytiCena' = MEMPTY,'76nabytiMena' = MEMPTY,
    '77predchoziMajitelSlovy' = MEMPTY,'78puvodniMajitelKod' = MEMPTY,
    '79prispevatelKod' = MEMPTY,'80nabytiPoznamka' = MEMPTY,
    '81lokalitaNalezuNazev' = Lokalita_S,'82lokalitaDoplneni' = MEMPTY,
    '83lokalitaOriginalni' = MEMPTY,'84nalezKatUzemiNazev' = MEMPTY,
    '85pozemekSlovy' = MEMPTY,'86nalezPoznamka' = MEMPTY,
    '87sGPSsirkaNS' = MEMPTY,'88sGPSsirkaStupne' = MEMPTY,
    '89sGPSsirkaMinuty' = MEMPTY,'90sGPSsirkaVteriny' = MEMPTY,
    '91sGPSdelkaEW' = MEMPTY,'92sGPSdelkaStupne' = MEMPTY,
    '93sGPSdelkaMinuty' = MEMPTY,'94sGPSdelkaVteriny' = MEMPTY,
    '95sGPSvyska' = MEMPTY,'96nalezSouradniceY' = MEMPTY,
    '97nalezSouradniceX' = MEMPTY,'98nalezSouradniceH' = MEMPTY,
    '99souradniceZdroj' = MEMPTY,'100souradnicePresnost' = MEMPTY,
    '101odborneUrceniHmotnost' = MEMPTY,'102numOuHodnota' = MEMPTY,
    '103numOudobaPlatnosti' = MEMPTY,'104numOuStatKod' = MEMPTY,
    '105numOuZeme' = MEMPTY,'106numOuTyp' = MEMPTY,
    '107numOuPopisHrana' = MEMPTY,'108milDruh' = MEMPTY,
    '109milVzor' = MEMPTY,'110milRaze' = MEMPTY,
    '111milVyrobniCislo' = MEMPTY,'112milKategorie' = MEMPTY,
    '113milPrukaz' = MEMPTY,'114milMistoUziti' = MEMPTY,
    '115rokPrirust' = MEMPTY,'116mnozstviSlovy' = MEMPTY,
    '117pocetCasti' = MEMPTY,'118popisCasti' = MEMPTY) %>% 
  mutate_all( ~ str_replace_all(., pattern = ";", replacement = " ")) %>% # removes semicolons
  mutate_all( ~ str_replace_all(., pattern = "[\r\n]", replacement = " ")) #removes paragraphs

write.table(mus_tab, paste0(path_csv, "csv_obp.csv"), 
            sep = ";", quote = F, row.names = F, 
            na = "", fileEncoding="cp1250")

```


## PAR

**DEMUS**: Sbirky 
**MUSEION**: csv_par.csv

**IMPORTNÍ ROZHRANNÍ**: CSV PAR


```{r MODIFY TABLE SBIRKY FOR PAR, eval = F}

modify_tab <- demus_tab %>% 
  mutate(MEMPTY = "") %>% 
  mutate('1typPredmetuKod' = "P")   %>% # always in case of OBP card
  mutate('2sbirkaCisloEvidInt' = sbirka) %>% 
  mutate('3podsbirkaCislo' = podsbirka) %>% 
  mutate('16fondKod' = case_when(
    Fond_S == "Filatelie a pohlednice" ~ "FP",
    Fond_S == "Military" ~ "M",
    Fond_S == "Plakáty" ~ "P",
    Fond_S == "Výtvarné umění" ~ "VU"
    ))
  
# n = 

# create CSV

mus_tab <- modify_tab %>% 
  select(
    '1typPredmetuKod' = '1typPredmetuKod', '2sbirkaCisloEvidInt'= '2sbirkaCisloEvidInt',
    '3podsbirkaCislo' = '3podsbirkaCislo', '4ciselnaRadaKod'= Rada_S,
    
    '5SPCislo' = MINVC, '6SPPoradoveCislo'= PorC_S, '7SPPoradoveCisloSub' = MSUB,
    '8SPCisloDo'= MINVCDO, '9SPPoradoveCisloDo'= HPorC_S, '10SPPoradoveCisloSubDo' = MSUBDO,
    
    '11SPDatumZapisu' = DatZap_S, '12cisloCES' = MEMPTY,
    '13prirustekCislo' = Plus2T_S,'14ciselnaRadaPrirustkuKod' = MEMPTY,
    '15nabytiPrirustkuDatum' = MEMPTY,'16fondKod' = '16fondKod',
    '17skupinaKod' = Skupina_S,
    '18podskupina1Kod' = MEMPTY, '19podskupina2Kod' = MEMPTY,'20podskupina3Kod' = MEMPTY,
    '21SPPocetKusu' = Pocet_S,'22jinaEvidence1Cislo' = MEMPTY,
    '23jinaEvidence2Cislo' = MEMPTY,'24jinaEvidence3Cislo' = JineC_S,
    
    '25SPPapirovaKarta' = Karta_S,'26SPKartaJeOpsana' = Opsana_S, # LOGICKE SLOUPCE
    '27materialovaSkupinaKod' = ,
    '28SPUIns' = Zapsal_S, '29SPDIns' = DatZap_S, # ZALOZENI ZAZNAMU
    '30SPUUpd' = MEMPTY, '31SPDUpd' = DatZm_S, # UPRAVA ZAZNAMU 
    '32stalaLokaceKod' = StLokace_S, '33aktualniLokaceKod' = AktLokace_S, # LOKACE
    '34predmetNazev' = Titul_S, '35oznaceni1Nazev' = Predmet_S, # PREDMET
    
    '36odborneUrceniPopis' = Popis_S, '37odborneUrceniPoznamka' = MEMPTY, 
    '38kompletnostKod' = MEMPTY, '39signatura' = MEMPTY,
    '40markant' = Sign_S, '41jazykSlovy' = MEMPTY, '42urcilOsobaKod' = Markant_S,
    '43dataceUrceniHodnota' = MEMPTY,'44odborneUrceniSchvaleno' = Urcil_S,
    '45schvalilOsobaKod' = DatUrc_S, '46datumSchvaleni' = MEMPTY,
    '47SPPoznamka' = MEMPTY,'48SPKlicovaSlova' = MEMPTY,
    
    '49pojistnaCena' = MEMPTY, '50pojistnaCenaMena' = MEMPTY,  # POJISTENI 
    '51pojistnaCenaDatum' = MEMPTY, '52ucetniCena' = MEMPTY, 
    '53SPDatumPosledniManipulace' = MEMPTY,
    
    '54text1' = MEMPTY, '55text2' = MEMPTY, '56text3' = MEMPTY, 
    '57text4' = MEMPTY, '58text5' = MEMPTY, '59text6' = MEMPTY,
    '60text7' = MEMPTY, '61text8' = MEMPTY, '62text9' = MEMPTY, '63text10' = MEMPTY,
    '64priznak1' = MEMPTY, '65priznak2' = MEMPTY,'66priznak3' = MEMPTY, 
    '67priznak4' = MEMPTY, '68priznak5' = MEMPTY,
    
    '69zpusobNabytiKod' = MEMPTY,'70nabytiPredmetuDatum' = MEMPTY,    # NABYTI
    '71nabytiPredmetuRokAkvizice' = MEMPTY,'72nabytiPredmetuDoklad' = MEMPTY, 
    '73nabytiCena' = MEMPTY,'74nabytiMena' = MEMPTY,
    '75predchoziMajitelSlovy' = MEMPTY,'76puvodniMajitelKod' = MEMPTY,
    '77prispevatelKod' = MEMPTY,'78nabytiPoznamka' = MEMPTY,
    
    '79lokalitaNalezuNazev' = MEMPTY,'80nalezKatUzemiNazev' = MEMPTY,   # LOKALITA
    '81pozemekSlovy' = Lokalita_S,'82nalezPoznamka' = MEMPTY,
    '83nalezGPSsirka' = MEMPTY,'84nalezGPSdelka' = MEMPTY,
    '85nalezGPSvyska' = MEMPTY,'86nalezSouradniceY' = MEMPTY,
    '87nalezSouradniceX' = MEMPTY,'88nalezSouradniceH' = MEMPTY,
    '89souradniceZdroj' = MEMPTY,'90souradnicePresnost' = MEMPTY,
    '91druhCislovaniParcelKod' = MEMPTY,'92pozemekKod' = MEMPTY,
    
    '93nalezArcheologieSouradniceSJTSK' = MEMPTY,'94nalezArcheologieNazevVyzkumu' = MEMPTY,
    '95nalezArcheologieRokVyzkumu' = MEMPTY,'96nalezArcheologieFirmaVyzkumu' = MEMPTY,
    '97nalezArcheologieVedouciVyzkumu' = MEMPTY,'98nalezCisloNalezoveZpravy' = MEMPTY,
    '99nalezArcheologieCiziVyzkum' = MEMPTY,'100nalezMisto' = MEMPTY,
    '101nalezKontext' = MEMPTY,'102nalezArcheologieKontext2' = MEMPTY,
    '103nalezArcheologieKontext3' = MEMPTY,'104nalezArcheologieKomponenta' = MEMPTY,
    '105nalezHloubka' = MEMPTY,'106nalezKraj' = MEMPTY,
    '107nalezOkres' = MEMPTY,'108nalezObec' = MEMPTY,
    '109nalezObecPuvodni' = MEMPTY,'110nalezCastObce' = MEMPTY,
    '111nalezMestskaCast' = MEMPTY,'112nalezCisloPopis' = MEMPTY,
    '113nalezUlice' = MEMPTY,'114nalezCisloOrient' = MEMPTY,
    '115nalezPSC' = MEMPTY,'116nalezKodStatu' = MEMPTY,
    
    '117rokPrirustku' = MEMPTY,'118mnozstviSlovy' = MEMPTY, 
    '119pocetCasti' = MEMPTY,'120popisCasti' = MEMPTY)

write.table(mus_tab, paste0(path_csv, "csv_par.csv"), 
            sep = ";", quote = F, row.names = F, 
            na = "", fileEncoding="cp1250")
```

## VUM

**DEMUS**: Sbirky 
**MUSEION**: csv_vum.csv

**IMPORTNÍ ROZHRANNÍ**: CSV VUM


```{r MODIFY TABLE SBIRKY FOR VUM, eval = F}

modify_tab <- demus_tab %>% 
  mutate(MEMPTY = "") %>% 
  mutate('1sbirkaCisloEvidInt' = sbirka) %>% 
  mutate('2podsbirkaCislo' = podsbirka) %>% 
  mutate('16fondKod' = case_when(
    Fond_S == "Filatelie a pohlednice" ~ "FP",
    Fond_S == "Military" ~ "M",
    Fond_S == "Plakáty" ~ "P",
    Fond_S == "Výtvarné umění" ~ "VU"
    ))
  
# n = 

# create CSV

mus_tab <- modify_tab %>% 
  select(
    '1sbirkaCisloEvidInt'= '1sbirkaCisloEvidInt', '2podsbirkaCislo' = '2podsbirkaCislo',
    '3ciselnaRadaKod'= Rada_S, '4SPCislo' = MINVC, 
    '5SPcisloCES' = MEMPTY, '6SPPoradoveCislo' = MEMPTY,    
    '7SPCisloDo' = MEMPTY, '8SPPoradoveCisloDo' = MEMPTY,    
    '9SPPoradoveCisloSub' = MEMPTY, '10SPPoradoveCisloSubDo' = MEMPTY,    
    '11SPDatumZapisu' = MEMPTY, '12odborneUrceniSchvaleno' = MEMPTY,    
    '13jinaEvidence1Cislo' = MEMPTY, '14jinaEvidence2Cislo' = MEMPTY,    
    '15jinaEvidence3Cislo' = MEMPTY, '16fondKod' = MEMPTY,    
    '17skupinaKod' = MEMPTY, '18podskupinaKod' = MEMPTY,    
    '19oznaceniNazev' = MEMPTY, '20SPPocetKusu' = MEMPTY, 
    
    '21pojistnaCena' = MEMPTY, '22pojistnaCenaMena' = MEMPTY,    
    '23pojistneCenaDatum' = MEMPTY, '24ucetniCena' = MEMPTY, 
    '25podskupina2Kod' = MEMPTY, '26podskupina3Kod' = MEMPTY,    
    '27SPPapirovaKarta' = MEMPTY, '28SPKartaJeOpsana' = MEMPTY,    
    '29urcilOsobaKod' = MEMPTY, '30dataceUrceniHodnota' = MEMPTY,    
    '31odborneUrceniPoznamka' = MEMPTY, '32odborneUrceniPopis' = MEMPTY,    
    '33odborneUrceniPopis2' = MEMPTY, '34lokalitaNalezuNazev' = MEMPTY,    
    '35lokalitaDoplneni' = MEMPTY, '36rokPrirustku' = MEMPTY,    
    '37puvodnost' = MEMPTY, '38zpusobAdjustace' = MEMPTY,    
    '39popisAdjustace' = MEMPTY, '40signatura' = MEMPTY,    
    '41markant' = MEMPTY, '42stupenZpracovani' = MEMPTY,    
    '43povahaZpracovani' = MEMPTY, '44sloh' = MEMPTY,    
    '45datumExpirace' = MEMPTY, '46stalaLokaceKod' = MEMPTY,    
    '47aktualniLokaceKod' = MEMPTY, '48SPPoznamka' = MEMPTY,    
    '49archivalie' = MEMPTY, '50zpusobNabytiKod' = MEMPTY,    
    '51nabytiPredmetuDatum' = MEMPTY, '52nabytiPredmetuDoklad' = MEMPTY,    
    '53nabytiPoznamka' = MEMPTY, '54nabytiPredchoziMajitelSlovy' = MEMPTY,    
    '55nabytiPredmetuRokAkvizice' = MEMPTY, '56nabytiCena' = MEMPTY,    
    '57nabytiMena' = MEMPTY, '58prirustekCislo' = MEMPTY,    
    '59ciselnaRadaPrirustkuKod' = MEMPTY, '60nabytiPrirustkuDatum' = MEMPTY,    
    '61schvalilOsobaKod' = MEMPTY, '62datumSchvaleni' = MEMPTY,    
    '63volne' = MEMPTY, '64SPDatumPosledniManipulace' = MEMPTY,    
    '65text1' = MEMPTY, '66text2' = MEMPTY, '67text3' = MEMPTY, 
    '68text4' = MEMPTY, '69text5' = MEMPTY, 
    '70SPpriznak1' = MEMPTY, '71SPpriznak2' = MEMPTY, 
    '72SPUIns' = MEMPTY, '73SPDIns' = MEMPTY, 
    '74SPUUpd' = MEMPTY,  '75SPDUpd' = MEMPTY, 
    '76puvodniMajitelKod' = MEMPTY, '77prispevatelKod' = MEMPTY, 
    '78text6' = MEMPTY,  '79text7' = MEMPTY, '80text8' = MEMPTY,     
    '81text9' = MEMPTY, '82text10' = MEMPTY,     
    '83priznak3' = MEMPTY, '84priznak4' = MEMPTY, '85priznak5' = MEMPTY, 
    '86mnozstviSlovy' = MEMPTY, '87pocetCasti' = MEMPTY, '88popisCasti' = MEMPTY)

write.table(mus_tab, paste0(path_csv, "csv_vum.csv"), 
            sep = ";", quote = F, row.names = F, 
            na = "", fileEncoding="cp1250")

```


\newpage

# 4. PROPOJENÍ




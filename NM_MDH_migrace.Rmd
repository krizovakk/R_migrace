---
title: "MIGRACE DAT - DEMUS / MUSEION"
subtitle: "Narodni Muzeum - Sbirka Muzea Delnickeho hnuti"
author: "Kateřina Křížová"
date: "2023-01-26"
output:
  pdf_document:
    toc: true
    toc_depth: 2
    number_sections: false
    fig_caption: true
  fontsize: 11pt
  geometry: margin=1in

---

\newpage 

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, message=FALSE, fig.dim = c(8, 4))

# PACKAGES

# install.packages("tidyverse", dependencies = T)
# install.packages("readxl")
# install.packages("stringr") # ::str_split_fixed
# install.packages("lubridate")
# install.packages("anytime")
require(tidyverse)
require(readxl)
require(stringr) # ::str_pad
require(lubridate) 
require(anytime) # ::anydate

```

\newpage 

# PROJEKT A CESTY

Narodni muzeum  
Sbirka Muzea Delnickeho hnuti

*Maska inventarniho cisla:*

\{S\}-\{\#\#\#\#\#\#\}/\{x\}   
  
  
S = inventarni rada  
\# = cislice  
x = podlomeni  

*Inventarni rady [10]:*  

 H11E - Modely   
 H11F - Fotografie a audiovizuální média  
 H11K - Knihy   
*H11M - Militaria (M)  
 H11N - Numismatika a faleristika  
*H11P - Plakáty (P)  
 H11R - Prapory a vlajky  
 H11S - Společnost a spolková činnost  
*H11T - Filatelie a pohlednice (FP)  
*H11U - Výtvarné umění (VU)  



```{r PROJECT SPECIFICATIONS AND PATHS, echo = T}

# project

spravce <- "NM-HM"
project <- "MDH"

sbirka <- "HM"
podsbirka <- "H11"

# paths

path <- "C:/Users/krizova/Documents/R/"

path_data <- paste0(path, "data/", project, "/")
path_csv <- paste0(path, "mus_csv/", spravce, "/", project, "/")

# ~

```


# PREPROCESSING

## Referenční tabulka *Sbirky*, vytvorteni MINVC

- vytvoreni inventarniho cisla
- k filtraci vazeb pro tvorbu slovníků  


```{r LOAD REFERENCE TABLE SBIRKY}

sbirky <- read_excel(paste0(path_data, "/Sbirky.xlsx")) %>% 
  
  select(-MSUBOD, -MSUBDO, -MINVC, -MINVCDO) %>%    # get rid of .accdb columns
  
  mutate(MPORC = str_pad(PorC_S, 6, pad = "0")) %>% 
  mutate(MPORCDO = str_pad(HPorC_S, 6, pad = "0"))  %>% 
  mutate(MSUB = ifelse(Lomeni_S == "_", NA, Lomeni_S)) %>% 
  mutate(MSUBDO = HLomeni_S) %>% 
  mutate(MINVC = case_when(is.na(MSUB) ~ paste0(Rada_S, "-", MPORC),
                             TRUE ~ paste0(Rada_S, "-", MPORC, "/", MSUB))) %>% 
  mutate(MINVCDO = case_when(is.na(MSUBDO) ~ "",
                             TRUE ~ paste0(Rada_S, "-", MPORCDO, "/", MSUBDO))) %>% 
  # select(-MPORC, -MPORCDO) %>%
  relocate(MINVC, .before = JineC_S) %>% 
  relocate(MINVCDO, .after = MINVC) 

# sbirky <- sbirky %>% 
#   select(Fond_S, Skupina_S) %>% 
#   distinct() %>% 
#   na.omit()


sb <- sbirky %>% 
  select(IdC_S, MINVC) # tabulka pro sledovani puvodniho a noveho inventarniho cisla

```


\newpage

# 1. PŘÍRŮSTKOVÁ KNIHA

Prirustkova kniha nebyla vyplnena. Prirustkova cisla byla zadana do Museionu rucne.  

\newpage

# 2. SLOVNÍKY

## Fondy

**DEMUS**: Fondy  
**MUSEION**: import_fond.csv  
  
**IMPORTNÍ ROZHRANNÍ**: CSV Fond  
 

```{r TABLE FONDY}

# L O A D

demus_tab <- read_excel(paste0(path_data, "Fondy.xlsx"))

# M O D I F Y

modify_tab <- demus_tab %>% 
  mutate(MEMPTY = "") %>% 
  mutate('1sbirkaCisloEvidInt' = sbirka) %>% 
  mutate('2podsbirkaCislo' = podsbirka)

modif_save <- paste0(path_csv, spravce, "_modif_fond.csv")

if(file.exists(modif_save)){
  print("You've been here before!")
} else {
  write.table(modify_tab, file = modif_save, 
            sep = ";", quote = T, row.names = F, 
            na = "", fileEncoding="cp1250")
  print("Operational file  S A V E D,  my dear!")
  }

# C R E A T E    C S V

mus_tab <- modify_tab %>% 
  select(
    '1sbirkaCisloEvidInt' = '1sbirkaCisloEvidInt',  # !! povinne !!
    '2podsbirkaCislo'= '2podsbirkaCislo',           # !! povinne !!
    '3fondKod' = MFOND,                             # !! povinne !!
    '4nazev'= Fond_FN,                              # !! povinne !!
    '5poznamka' = Pozn_FN, '6popisPubl'= MEMPTY,
    '7poradi' = MEMPTY, '8oaiId'= MEMPTY,
    '9oaiDatumHarvestingu'= MEMPTY, '10oaiDatumModifikace' = MEMPTY)
oper_fondy <- mus_tab

# S A V E   I M P O R T   C S V

save <- paste0(path_csv, spravce, "_import_fond.csv")

if(file.exists(save)){
  print("You've been here before!")
} else {
  write.table(mus_tab, file = save, 
            sep = ";", quote = T, row.names = F, 
            na = "", fileEncoding="cp1250")
  print("Import written, baby!")
  }

```


## Skupiny

**DEMUS**: Skupiny  
**MUSEION**: import_skupiny.csv

**IMPORTNÍ ROZHRANNÍ**: CSV Skupiny


```{r PREPROCESSING SKUPINY}

fond_skup <- merge(oper_fondy, sbirky, by.x = "4nazev", by.y = "Fond_S") %>% 
  select("3fondKod", "Skupina_S")

```


```{r TABLE SKUPINY}

# L O A D

demus_tab <- read_excel(paste0(path_data, "Skupiny.xlsx"))

# M O D I F Y

modify_tab <- merge(fond_skup, demus_tab, 
                    by.x = "Skupina_S", by.y = "Skup_SK", all.x = T) %>% 
  mutate(MEMPTY = "") %>% 
  mutate('1sbirkaCisloEvidInt' = sbirka) %>% 
  mutate('2podsbirkaCislo' = podsbirka) %>% 
  mutate('5nazev' = case_when(Slovy_SK == "" ~ Skupina_S, 
                              TRUE ~ Slovy_SK)) %>% 
  distinct() %>% 
  na.omit()

modif_save <- paste0(path_csv, spravce, "_modif_skupiny.csv")

if(file.exists(modif_save)){
  print("You've been here before!")
} else {
  write.table(modify_tab, file = modif_save, 
            sep = ";", quote = T, row.names = F, 
            na = "", fileEncoding="cp1250")
  print("Operational file  S A V E D,  my dear!")
  }

# C R E A T E    C S V

mus_tab <- modify_tab %>% 
  select(
    '1sbirkaCisloEvidInt' = '1sbirkaCisloEvidInt', # !! povinne !!
    '2podsbirkaCislo'= '2podsbirkaCislo',          # !! povinne !!
    '3fondKod' ='3fondKod',                        # !! povinne !!
    '4skupinaKod'= Skupina_S,                      # !! povinne !!
    '5nazev' = '5nazev',                           # !! povinne !!
    '6poznamka'= MEMPTY,
    '7popisPubli' = MEMPTY, '8poradi'= MEMPTY,
    '9oaiId'= MEMPTY, '10oaiDatumHarvestingu'= MEMPTY, 
    '11oaiDatumModifikace' = MEMPTY)

oper_skupiny <- mus_tab

# S A V E   I M P O R T   C S V

save <- paste0(path_csv, spravce, "_import_skupiny.csv")

if(file.exists(save)){
  print("You've been here before!")
} else {
  write.table(mus_tab, file = save, 
            sep = ";", quote = T, row.names = F, 
            na = "", fileEncoding="cp1250")
  print("Import written, baby!")
  }

```

## Adresář

**DEMUS**: Adresar  
**MUSEION**: import_adresar.csv

**IMPORTNÍ ROZHRANNÍ**: CSV Adresář osob


```{r TABLE ADRESAR}

# L O A D

demus_tab <- read_excel(paste0(path_data, "/Adresar.xlsx"))
demus_tab[is.na(demus_tab)] <- ""

# M O D I F Y

modify_tab <- demus_tab %>% 
  mutate(MEMPTY = "") %>% 
  mutate('1typSubjektuKod' = "OO") %>% 
  mutate('2subjektKod' = str_trim(paste0(Prijmeni_A, " ", Jmeno_A))) %>% 
  mutate('10osobaPohlavi' = "neznámé") %>%  # povinne: "muž", "žena", "neznámé"
  mutate('18subjektStatKod' = "CZ")

modif_save <- paste0(path_csv, spravce, "_modif_adresar.csv")

if(file.exists(modif_save)){
  print("You've been here before!")
} else {
  write.table(modify_tab, file = modif_save, 
            sep = ";", quote = T, row.names = F, 
            na = "", fileEncoding="cp1250")
  print("Operational file  S A V E D,  my dear!")
  }

# C R E A T E    C S V

mus_tab <- modify_tab %>% 
  select('1typSubjektuKod' = '1typSubjektuKod', # !! povinne !!
         '2subjektKod' = '2subjektKod',         # !! povinne !!
         '3subjektAlterKod' = MEMPTY, '4osobaJmenoPrvni'= Jmeno_A, 
         '5osobaJmenoDruhe' = MEMPTY, 
         '6osobaPrijmeni' = Prijmeni_A,         # !! povinne !!
         '7osobaTitulPredJmenem' = TitPred_A, '8osobaTitulZaJmenem' = TitZa_A, 
         '9osobaRodnePrijmeni' = MEMPTY, 
         '10osobaPohlavi' = '10osobaPohlavi',   # !! povinne !! "muž", "žena", "neznámé"
         '11osobaDatumNarozeni' = MEMPTY, '12osobaMistoNarozeni' =MEMPTY,
         '13okresNarozeniNazev' = MEMPTY, '14obecNarozeniNazev' = MEMPTY,
         '15statNarozeniKod' = MEMPTY, '16osobaDatumUmrti' = MEMPTY,
         '17osobaMistoUmrti' = MEMPTY, '18subjektStatKod' = '18subjektStatKod',
         '19kontaktEmail' = MEMPTY, '20kontaktMobil' = MEMPTY,
         '21kontaktMobil2' = MEMPTY, '22kontaktTelefon' = MEMPTY,
         '23kontaktInternet' = MEMPTY, '24kontaktInternetoveVolani' = MEMPTY,
         '25adresaText' = MEMPTY, '26kontaktniAdresaText' = MEMPTY,
         '27fyzickaOsobaRodneCislo' = MEMPTY, '28subjektPoznamka' = MEMPTY,
         '29AdresaTextoveOkres' = MEMPTY, '30AdresaTextoveObec' = MEMPTY,
         '31AdresaTextoveCastObce' = MEMPTY, '32AdresaTextoveMestskaCast' = MEMPTY,
         '33AdresaTextoveUlice' = MEMPTY, '34AdresaTextoveCisloOrientacni' = MEMPTY,
         '35AdresaTextoveCislo' = MEMPTY, '36AdresaTextovePSC' = MEMPTY,
         '37zamestnanecCislo' = MEMPTY, '38oddeleniKod' = MEMPTY,
         '39osobnostMedailon' = MEMPTY, '40osobnostPseudonym' = MEMPTY,
         '41okruhSubjektuNazev' = MEMPTY, '42subjektSbirka' =  MEMPTY,           
         '43subjektPodsbirka' =  MEMPTY, '44osobaStudia' = MEMPTY,
         '45osobaSpolky' = MEMPTY, '46osobaOsobnost' = MEMPTY,
         '47subjektDatumOd' = MEMPTY, '48subjektDatumDo' = MEMPTY,
         '49kontaktEmail2' = MEMPTY, 
         '50text1' = MEMPTY, '51text2' = MEMPTY, '52text3' = MEMPTY, 
         '53role1' = MEMPTY, '54role2' = MEMPTY, 
         '55role3' = MEMPTY, '56role4' = MEMPTY, '57$role5' = MEMPTY,
         rel_ZkrJm = ZkrJm_A)

oper_adresar <- mus_tab %>% 
  select(rel_ZkrJm, '1typSubjektuKod', '2subjektKod', '4osobaJmenoPrvni', '6osobaPrijmeni')

# S A V E   I M P O R T   C S V

save <- paste0(path_csv, spravce, "_import_adresar.csv")

if(file.exists(save)){
  print("You've been here before!")
} else {
  write.table(mus_tab, file = save, 
            sep = ";", quote = T, row.names = F, 
            na = "", fileEncoding="cp1250")
  print("Import written, baby!")
  }

```

## OO / PO

```{r LOAD TABLE OSOBNOSTI}

# L O A D

demus_tab <- read_excel(paste0(path_data, "/Osobnosti.xlsx"))
# demus_tab[is.na(demus_tab)] <- ""

```
 

### OO

**DEMUS**: Osobnosti  
**MUSEION**: import_oo.csv

**IMPORTNÍ ROZHRANNÍ**: CSV Adresář osob

```{r TABLE OO}

# M O D I F Y 

modify_tab <- demus_tab %>% 
  filter(MTYPOSOSBY == "OO") %>% 
  mutate(MKODOS = str_trim(paste0(MPRIJM, " ", MJMENO))) %>% 
  mutate(MEMPTY = "") %>% 
  mutate('10osobaPohlavi' = "neznámé") %>% 
   # mutate('18subjektStatKod' = "CZ") %>% 
  mutate('42subjektSbirka' = sbirka) %>% 
  mutate('43subjektPodsbirka' = podsbirka) 

modify_tab <- modify_tab[!(modify_tab$Jmeno_OS == "1910_00_00"),]
modify_tab

modif_save <- paste0(path_csv, spravce, "_modif_oo.csv")

if(file.exists(modif_save)){
  print("You've been here before!")
} else {
  write.table(modify_tab, file = modif_save, 
            sep = ";", quote = T, row.names = F, 
            na = "", fileEncoding="cp1250")
  print("Operational file  S A V E D,  my dear!")
  }

# C R E A T E    C S V

mus_tab <- modify_tab %>% 
  select('1typSubjektuKod' = MTYPOSOSBY,        # !! povinne !!
         '2subjektKod' = MKODOS,                # !! povinne !!
         '3subjektAlterKod' = MEMPTY, '4osobaJmenoPrvni'= MJMENO, 
         '5osobaJmenoDruhe' = MDRJMENO, 
         '6osobaPrijmeni' = MPRIJM,             # !! povinne !!
         '7osobaTitulPredJmenem' = MTITULPRED, '8osobaTitulZaJmenem' = MEMPTY, 
         '9osobaRodnePrijmeni' = MEMPTY, 
         '10osobaPohlavi' = '10osobaPohlavi',   # !! povinne !! "muž", "žena", "neznámé"
         '11osobaDatumNarozeni' = MEMPTY, '12osobaMistoNarozeni' = MistoNar_OS,
         '13okresNarozeniNazev' = MEMPTY, '14obecNarozeniNazev' = MEMPTY,
         '15statNarozeniKod' = MEMPTY, '16osobaDatumUmrti' = MEMPTY,
         '17osobaMistoUmrti' = MistoUmr_OS, '18subjektStatKod' = MEMPTY,
         '19kontaktEmail' = MEMPTY, '20kontaktMobil' = MEMPTY,
         '21kontaktMobil2' = MEMPTY, '22kontaktTelefon' = MEMPTY,
         '23kontaktInternet' = MEMPTY, '24kontaktInternetoveVolani' = MEMPTY,
         '25adresaText' = MEMPTY, '26kontaktniAdresaText' = MEMPTY,
         '27fyzickaOsobaRodneCislo' = MEMPTY, '28subjektPoznamka' = MEMPTY,
         '29AdresaTextoveOkres' = MEMPTY, '30AdresaTextoveObec' = MEMPTY,
         '31AdresaTextoveCastObce' = MEMPTY, '32AdresaTextoveMestskaCast' = MEMPTY,
         '33AdresaTextoveUlice' = MEMPTY, '34AdresaTextoveCisloOrientacni' = MEMPTY,
         '35AdresaTextoveCislo' = MEMPTY, '36AdresaTextovePSC' = MEMPTY,
         '37zamestnanecCislo' = MEMPTY, '38oddeleniKod' = MEMPTY,
         '39osobnostMedailon' = Medailon_OS, '40osobnostPseudonym' = MEMPTY,
         '41okruhSubjektuNazev' = MEMPTY, 
         
         '42subjektSbirka' = '42subjektSbirka',           # ENTER MANUALLY 
         '43subjektPodsbirka' = '43subjektPodsbirka',     # ENTER MANUALLY 
         
         '44osobaStudia' = MEMPTY,
         '45osobaSpolky' = MEMPTY, '46osobaOsobnost' = MEMPTY,
         '47subjektDatumOd' = DatNar_OS, '48subjektDatumDo' = DatUmr_OS,
         '49kontaktEmail2' = MEMPTY, 
         '50text1' = MEMPTY, '51text2' = MEMPTY, '52text3' = MEMPTY, 
         '53role1' = MEMPTY, '54role2' = MEMPTY, 
         '55role3' = MEMPTY, '56role4' = MEMPTY, '57$role5' = MEMPTY,
         rel_puvKOD = Jmeno_OS)

oper_oo <- mus_tab %>% 
  select(rel_puvKOD, '1typSubjektuKod', '2subjektKod', '4osobaJmenoPrvni', '6osobaPrijmeni')

# S A V E   I M P O R T   C S V

save <- paste0(path_csv, spravce, "_import_oo.csv")

if(file.exists(save)){
  print("You've been here before!")
} else {
  write.table(mus_tab, file = save, 
            sep = ";", quote = T, row.names = F, 
            na = "", fileEncoding="cp1250")
  print("Import written, baby!")
  }

```


### PO

**DEMUS**: Osobnosti  
**MUSEION**: import_po.csv

**IMPORTNÍ ROZHRANNÍ**: CSV Adresář právnických osob


```{r TABLE PO}

# M O D I F Y

zkr <- c("SVOBODA PRAHA", "Agfa", "Blesk Praha I", "ČVT 08 HB", "GZ Bernasek Prazena", "HP", "KSČ Praha XII", "Litera", "LITEVNA", "Nakl. V. Kátkoruký", "ORBIS", "ORBIS 02", "Orbis n.p.", "PPSP SSSR v ČSR", "B.Just Smíchov", "Unionbild", "V. Kovařík Bohušovice")

modify_tab <- demus_tab %>% 
  filter(MTYPOSOSBY == "PO") %>% 
  mutate(MEMPTY = "") %>%  
  mutate('1subjektKod' = zkr) %>% 
  mutate('26subjektSbirka' = sbirka) %>% 
  mutate('27subjektPodsbirka' = podsbirka)

rm(zkr)

modif_save <- paste0(path_csv, spravce, "_modif_po.csv")

if(file.exists(modif_save)){
  print("You've been here before!")
} else {
  write.table(modify_tab, file = modif_save, 
            sep = ";", quote = T, row.names = F, 
            na = "", fileEncoding="cp1250")
  print("Operational file  S A V E D,  my dear!")
}

# C R E A T E    C S V

mus_tab <- modify_tab %>% 
  select(
    '1subjektKod' = '1subjektKod',          # !! povinne !!
    '2subjektAlterKod'= MEMPTY,
    '3pravnickaOsobaNazev' = Jmeno_OS,      # !! povinne !!
    '4pravnickaOsobaIC'= MEMPTY,
    '5pravnickaOsobaDIC' = MEMPTY, '6pravnickaOsobaZapsan'= MEMPTY,
    '7pravnickaOsobaFOP' = MEMPTY, '8subjektStatKod'= MEMPTY,
    '9kontaktEmail' = MEMPTY, '10kontaktMobil'= MEMPTY,
    '11kontaktMobil2' = MEMPTY, '12kontaktTelefon'= MEMPTY,
    '13kontaktInternet' = MEMPTY, '14kontaktInternetoveVolani'= MEMPTY,
    '15adresaText' = MEMPTY, '16kontaktniAdresaText'= MEMPTY,
    '17subjektPoznamka' = MEMPTY, '18AdresaTextoveOkres'= MEMPTY,
    '19AdresaTextoveObec' = MEMPTY, '20AdresaTextoveCastObce'= MEMPTY,
    '21AdresaTextoveMestskaCast' = MEMPTY, '22AdresaTextoveUlice'= MEMPTY,
    '23AdresaTextoveCisloOrientacni' = MEMPTY, '24AdresaTextoveCislo'= MEMPTY,
    '25AdresaTextovePSC' = MEMPTY,  '26subjektSbirka'= '26subjektSbirka',           
    '27subjektPodsbirka' = '27subjektPodsbirka', '28subjektDatumOd'= MEMPTY,
    '29subjektDatumDo' = MEMPTY, '30subjektMedailon'= Medailon_OS,
    '31okruhSubjektuNazev' = MEMPTY, '32kontaktEmail2'= MEMPTY,
    '33text1' = MEMPTY, '34text2'= MEMPTY,'35text3' = MEMPTY, 
    '36role1'= MEMPTY, '37role2' = MEMPTY, '38role3'= MEMPTY,
    '39role4' = MEMPTY, '40role5'= MEMPTY,
     rel_KODOS = Jmeno_OS)

oper_po <- modify_tab %>% 
  select(rel_puvKOD = Jmeno_OS, MTYPOSOSBY, '1subjektKod', nazev = Jmeno_OS)

# S A V E   I M P O R T   C S V

save <- paste0(path_csv, spravce, "_import_po.csv")

if(file.exists(save)){
  print("You've been here before!")
} else {
  write.table(mus_tab, file = save, 
            sep = ";", quote = T, row.names = F, 
            na = "", fileEncoding="cp1250")
  print("Import written, baby!")
  }

```

## AD + OO + PO (interni slovnik)

```{r JOIN AD OO PO IN ONE DICT}

ad <- oper_adresar %>% 
  mutate(typos = "AD",
         puvkod = rel_ZkrJm) %>% 
  rename(novykod = '2subjektKod',
         jmeno = '4osobaJmenoPrvni',
         prijm = '6osobaPrijmeni') %>% 
  select(typos, puvkod, novykod, jmeno, prijm)

oo <- oper_oo %>% 
  mutate(typos = "OO",
         puvkod = rel_puvKOD) %>% 
  rename(novykod = '2subjektKod',
         jmeno = '4osobaJmenoPrvni',
         prijm = '6osobaPrijmeni')%>% 
  select(typos, puvkod, novykod, jmeno, prijm)

po <- oper_po %>% 
  mutate(typos = "PO",
         puvkod = rel_puvKOD,
         prijm = "") %>% 
   rename(novykod = '1subjektKod',
         jmeno = nazev)%>% 
  select(typos, puvkod, novykod, jmeno, prijm)

interni_adresar <- bind_rows(ad, oo, po)

# S A V E   F I L E

save <- paste0(path_csv, "_", spravce, "_INTERNI_ADRESAR.csv")

if(file.exists(save)){
  print("You've been here before!")
} else {
  write.table(interni_adresar, file = save, 
            sep = ";", quote = T, row.names = F, 
            na = NA, fileEncoding="cp1250")
  print("Import written, baby!")
  }


```



## Lokality

**DEMUS**: Lokality  
**MUSEION**: import_lokalita.csv

**IMPORTNÍ ROZHRANNÍ**: CSV Lokalita

```{r TABLE LOKALITY}

# L O A D

demus_tab <- read_excel(paste0(path_data, "Lokality.xlsx"))

# M O D I F Y

modify_tab <- demus_tab %>% 
  mutate(MEMPTY = "")

modif_save <- paste0(path_csv, spravce, "_modif_lokalita.csv")

if(file.exists(modif_save)){
  print("You've been here before!")
} else {
  write.table(modify_tab, file = modif_save, 
            sep = ";", quote = T, row.names = F, 
            na = "", fileEncoding="cp1250")
  print("Operational file  S A V E D,  my dear!")
  }

# C R E A T E    C S V

mus_tab <- modify_tab %>% 
  select(
    '1lokalitaNazev' = Lokalita_L,  # !! povinne !!
    '2okresNazev'= MEMPTY,
    '3statKod' = MEMPTY, '4oblastNazev'= MEMPTY,
    '5lokalitaZeme' = MEMPTY, '6lokalitaCtverec'= MEMPTY,
    '7lokalitaMapa' = MEMPTY, '8lokalitaZemepisnaSirka'= MEMPTY,
    '9lokalitaZemepisnaDelka'= MEMPTY, '10lokalitaNadmorskaVyska'= MEMPTY,
    '11lokalitaPoznamka'= MEMPTY, '12lokalitaSbirka'= MEMPTY,
    '13lokalitaPodsbirka'= MEMPTY, '14fytochorion1'= MEMPTY,
    '15lokalitaPublicNadNazev'= MEMPTY, '16lokalitaPublicNazev'= MEMPTY,
    '17fytochorion2'= MEMPTY, '18fytochorion3'= MEMPTY,
    '19fytochorion4'= MEMPTY)

oper_lokalita <- mus_tab

# S A V E   I M P O R T   C S V

save <- paste0(path_csv, spravce, "_import_lokalita.csv")

if(file.exists(save)){
  print("You've been here before!")
} else {
  write.table(mus_tab, file = save, 
            sep = ";", quote = T, row.names = F, 
            na = "", fileEncoding="cp1250")
  print("Import written, baby!")
  }

```



## Materiály

**DEMUS**: Materialy  
**MUSEION**: import_material.csv

**IMPORTNÍ ROZHRANNÍ**: CSV Materiál

```{r TABLE MATERIALY, warning = F}

# L O A D

demus_tab <- read_excel(paste0(path_data, "Materialy.xlsx"))
# demus_tab[is.na(demus_tab)] <- ""
 
# M O D I F Y

modify_tab <- demus_tab %>% 
  mutate(MEMPTY = "") %>% 
  mutate('1sbirkaCisloEvidInt' = sbirka) %>% 
  mutate('2podsbirkaCislo' = podsbirka) %>% 
  mutate(MMAT = Material_MA) %>% 
  separate(MMAT,into=c("MMAT1", "MMAT2", "MMAT3", "MMAT4", "MMAT5") , sep=",|;") %>% 
  pivot_longer(
    cols = MMAT1:MMAT5, 
    names_to = "MMAT_POR", # poradi materialu
    values_to = "MMAT_AGG",
    values_drop_na = TRUE) %>% 
  mutate(MMATERIAL = str_trim(MMAT_AGG)) # remove white space

modify_tab <- modify_tab[!duplicated(modify_tab$MMATERIAL),]

modif_save <- paste0(path_csv, spravce, "_modif_material.csv")

if(file.exists(modif_save)){
  print("You've been here before!")
} else {
  write.table(modify_tab, file = modif_save, 
            sep = ";", quote = T, row.names = F, 
            na = "", fileEncoding="cp1250")
  print("Operational file  S A V E D,  my dear!")
  }

# C R E A T E    C S V

mus_tab <- modify_tab %>% 
  select(
    '1sbirkaCisloEvidInt' = '1sbirkaCisloEvidInt', '2podsbirkaCislo'= '2podsbirkaCislo',
    '3materialovaSkupinaKod' = MEMPTY, 
    '4materialNazev'= MMATERIAL,  # !! povinne !!
    '5materialPoznamka' = Pozn_MA, '6materialPublicNadNazev'= MEMPTY,
    '7materialPublicNazev' = MEMPTY, '8materialNazevAnglicky'= MEMPTY,
    '9materialNazevNemecky'= MEMPTY)

oper_material <- mus_tab

# S A V E   I M P O R T   C S V

save <- paste0(path_csv, spravce, "_import_material.csv")

if(file.exists(save)){
  print("You've been here before!")
} else {
  write.table(mus_tab, file = save, 
            sep = ";", quote = T, row.names = F, 
            na = "", fileEncoding="cp1250")
  print("Import written, baby!")
  }

```


## Techniky

**DEMUS**: Techniky  
**MUSEION**: import_technika.csv

**IMPORTNÍ ROZHRANNÍ**: CSV Technika 

```{r TABLE TECHNIKY, warning = F}

# L O A D

demus_tab <- read_excel(paste0(path_data, "Techniky.xlsx"))
# demus_tab[is.na(demus_tab)] <- ""

# M O D I F Y

modify_tab <- demus_tab %>% 
  mutate(MEMPTY = "") %>% 
  mutate('1sbirkaCisloEvidInt' = sbirka) %>% 
  mutate('2podsbirkaCislo' = podsbirka) %>% 
  mutate(MTECH = Technika_TE) %>% 
  separate(MTECH,into=c("MTECH1", "MTECH2", "MTECH3", "MTECH4", "MTECH5"),
           sep=",(?! tuší)") %>% # separator is ',' BUT ONLY IF NOT FOLLOWED BY ' tuší' -> solves a single case of 'kresba tužkou, tuší a bělobou' which should remain as one entry
  pivot_longer(
    cols = MTECH1:MTECH5, 
    names_to = "MTECH_POR", # poradi techniky
    values_to = "MTECH_AGG",
    values_drop_na = TRUE) %>% 
  mutate(MTECHNIKA = str_trim(MTECH_AGG)) %>% # remove white space
  select(-MTECH_AGG) %>% 
  mutate(MTECH_POR = substr(MTECH_POR, 5, 5))

modify_tab <- modify_tab[!duplicated(modify_tab$MTECHNIKA),]

modif_save <- paste0(path_csv, spravce, "_modif_technika.csv")

if(file.exists(modif_save)){
  print("You've been here before!")
} else {
  write.table(modify_tab, file = modif_save, 
            sep = ";", quote = T, row.names = F, 
            na = "", fileEncoding="cp1250")
  print("Operational file  S A V E D,  my dear!")
  }

# C R E A T E    C S V

mus_tab <- modify_tab %>% 
  select(
    '1sbirkaCisloEvidInt' = '1sbirkaCisloEvidInt', '2podsbirkaCislo'= '2podsbirkaCislo', 
    '3materialovaSkupinaKod' = MEMPTY, 
    '4technikaNazev'= MTECHNIKA,  # !! povinne !!
    '5technikaPoznamka' = Pozn_TE, '6technikaPublicNadNazev'= MEMPTY,
    '7technikaPublicNazev' = MEMPTY, '8technikaNazevAnglicky'= MEMPTY,
    '9technikaNazevNemecky'= MEMPTY)

oper_technika <- mus_tab

# S A V E   I M P O R T   C S V

save <- paste0(path_csv, spravce, "_import_technika.csv")

if(file.exists(save)){
  print("You've been here before!")
} else {
  write.table(mus_tab, file = save, 
            sep = ";", quote = T, row.names = F, 
            na = "", fileEncoding="cp1250")
  print("Import written, baby!")
  }

```

## Rozměry

Zde nebylo treba resit rozmery slovnikem.  
Byly zkontrolovany jiz zadane hodnoty ve slovnku Museionu.  

```{r}
# roz <- read_excel(paste0(path_data, "Rozmery.xlsx"))
```


## Označení

**DEMUS**: Nazvy 
**MUSEION**: import_oznaceni.csv

**IMPORTNÍ ROZHRANNÍ**: CSV Označení 

```{r TABLE NAZVY, warning = F}

# L O A D

demus_tab <- read_excel(paste0(path_data, "Nazvy.xlsx"))
# demus_tab[is.na(demus_tab)] <- ""

# M O D I F Y

modify_tab <- demus_tab %>% 
  mutate(MEMPTY = "") %>% 
  mutate('1sbirkaCisloEvidInt' = sbirka) %>% 
  mutate('2podsbirkaCislo' = podsbirka) 

modif_save <- paste0(path_csv, spravce, "_modif_oznaceni.csv")

if(file.exists(modif_save)){
  print("You've been here before!")
} else {
  write.table(modify_tab, file = modif_save, 
            sep = ";", quote = T, row.names = F, 
            na = "", fileEncoding="cp1250")
  print("Operational file  S A V E D,  my dear!")
  }

# C R E A T E    C S V

mus_tab <- modify_tab %>% 
  select(
    '1sbirkaCisloEvidInt' = '1sbirkaCisloEvidInt', # !! povinne !!
    '2podsbirkaCislo'= '2podsbirkaCislo',          # !! povinne !!
    '3materialovaSkupinaKod' = MEMPTY, 
    '4oznaceniNazev'= Nazev_NZ,                   # !! povinne !!
    '5oznaceniPoznamka' = Pozn_NZ)

oper_oznaceni <- mus_tab

# S A V E   I M P O R T   C S V

save <- paste0(path_csv, spravce, "_import_oznaceni.csv")

if(file.exists(save)){
  print("You've been here before!")
} else {
  write.table(mus_tab, file = save, 
            sep = ";", quote = T, row.names = F, 
            na = "", fileEncoding="cp1250")
  print("Import written, baby!")
  }

```

\newpage


\newpage 

# 3. PŘEDMĚTY

OBP = obecný předmět  
PAR = archeologie  
VUM = výtvarné umění  
FOT = fotografická karta  
BIO = přírodovědná   
BR  = book report  

```{r LOAD TABLE AKVIZICE JOIN WITH SBIRKY}

akvizice <- read_excel(paste0(path_data, "Akvizice.xlsx")) %>% 
  mutate(MPRIR_rada = substr(PrirC_AQ, 1, 4)) %>% 
  mutate(MPRIR_cislo = str_pad(substr(PrirC_AQ, 6, 6), 4, pad = "0")) %>% # 4 mistne cislo
  mutate(MPRIR_rok= substr(PrirC_AQ, 8, 11)) 

demus_tab <- merge(sbirky, akvizice, by.x = "IdC_S", by.y = "IdC_AQ", all.x = T) 

# n = 1087

```


## OBP

**DEMUS**: Sbirky 
**MUSEION**: import_obp.csv

**IMPORTNÍ ROZHRANNÍ**: CSV OBP


```{r MODIFY TABLE SBIRKY FOR OBP}

# M O D I F Y

modify_tab <- demus_tab %>% 
  mutate(MEMPTY = "") %>% 
  mutate('1typPredmetuKod' = "P")   %>%         # povinný - "P", "NU", "MI", "HM", "DI", "F1"
  mutate('2sbirkaCisloEvidInt' = sbirka) %>% 
  mutate('3podsbirkaCislo' = podsbirka) %>% 
  mutate('13prirustekCislo' = ifelse(is.na(MPRIR_rada), "", paste0(MPRIR_rada, "-", MPRIR_cislo, "/", MPRIR_rok))) %>% 
  mutate('16fondKod' = case_when(
    Fond_S == "Filatelie a pohlednice" ~ "FP",
    Fond_S == "Military" ~ "M",
    Fond_S == "Plakáty" ~ "P",
    Fond_S == "Výtvarné umění" ~ "VU"
    )) %>% 
  mutate('11SPDatumZapisu' = format(as.Date(DatZap_S),"%d.%m.%Y")) %>%         # date format
  mutate('29SPDIns'= format(as.Date(DatZap_S),"%d.%m.%Y")) %>% 
  mutate('44urcilOsobaKod' = ifelse(Urcil_S %in% oper_adresar$rel_ZkrJm, oper_adresar$'2subjektKod', "?")) %>%  # z tabulky oper_adresar !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
  mutate('45dataceUrceniHodnota' = format(as.Date(DatUrc_S),"%d.%m.%Y")) %>% 
  mutate('72nabytiPredmetuDatum' = format(as.Date(DatAkv_AQ),"%d.%m.%Y")) %>% 
  mutate('25SPPapirovaKarta' = as.integer(as.logical(Karta_S))) %>%            # logical
  mutate('26SPKartaJeOpsana' = as.integer(as.logical(Opsana_S))) %>% 
  mutate('27archivalie' = as.integer(as.logical(Archiv_S)))

modif_save <- paste0(path_csv, spravce, "_modif_obp.csv")

if(file.exists(modif_save)){
  print("You've been here before!")
} else {
  write.table(modify_tab, file = modif_save, 
            sep = ";", quote = T, row.names = F, 
            na = "", fileEncoding="cp1250")
  print("Operational file  S A V E D,  my dear!")
  }

# C R E A T E    C S V

mus_tab <- modify_tab %>% 
  select(
    '1typPredmetuKod' = '1typPredmetuKod',        # !! povinne !!
    '2sbirkaCisloEvidInt'= '2sbirkaCisloEvidInt', # !! povinne !! ze slovniku
    '3podsbirkaCislo' = '3podsbirkaCislo',        # !! povinne !! ze slovniku
    '4ciselnaRadaKod'= Rada_S,                    # !! povinne !! ze slovniku
    
    '5SPCislo' = MINVC,                           # !! povinne !!
    '6SPPoradoveCislo'= PorC_S, 
    '7SPPoradoveCisloSub' = MSUB,
    '8SPCisloDo'= MINVCDO, 
    '9SPPoradoveCisloDo'= HPorC_S, 
    '10SPPoradoveCisloSubDo' = MSUBDO,
    
    '11SPDatumZapisu' = '11SPDatumZapisu', 
    '12cisloCES' = MEMPTY, 
    '13prirustekCislo' = '13prirustekCislo', 
    '14ciselnaRadaPrirustkuKod' = MEMPTY, 
    '15nabytiPrirustkuDatum' = MEMPTY, 
    '16fondKod' = '16fondKod',
    '17skupinaKod' = Skupina_S, 
    '18podskupina1Kod' = MEMPTY, 
    '19podskupina2Kod' = MEMPTY,
    '20podskupina3Kod' = MEMPTY,
    '21SPPocetKusu' = Pocet_S,                    # !! povinne !!
    '22jinaEvidence1Cislo' = JineC_S,
    '23jinaEvidence2Cislo' = MEMPTY,
    '24jinaEvidence3Cislo' = MEMPTY,
    '25SPPapirovaKarta' = '25SPPapirovaKarta',    # LOGICKE SLOUPCE
    '26SPKartaJeOpsana' = '26SPKartaJeOpsana', 
    '27archivalie' = '27archivalie',
    '28SPUIns' = Zapsal_S,  # text, nemusi byt slovnik    # ZALOZENI ZAZNAMU
    '29SPDIns' = '29SPDIns',                      
    '30SPUUpd' = MEMPTY,                          # UPRAVA ZAZNAMU 
    '31SPDUpd' = MEMPTY, 
    '32stalaLokaceKod' = MEMPTY,                  # LOKACE (migruje se zvlast)
    '33aktualniLokaceKod' = MEMPTY, 
    '34predmetNazev' = Titul_S,                   # PREDMET
    '35oznaceni1Nazev' = Predmet_S, 
    '36odborneUrceniPopis' = Popis_S, 
    '37odborneUrceniPopis2' = MEMPTY, 
    '38odborneUrceniPoznamka' = Pozn_S, 
    '39kompletnostKod' = MEMPTY,
    '40signatura' = Sign_S, '41signatura2' = MEMPTY, '42markant' = Markant_S,
    '43jazykSlovy' = MEMPTY,
    '44urcilOsobaKod' = '44urcilOsobaKod',
    '45dataceUrceniHodnota' = '45dataceUrceniHodnota', 
    '46odborneUrceniSchvaleno' = MEMPTY,
    '47schvalilOsobaKod' = MEMPTY,
    '48datumSchvaleni' = MEMPTY,
    '49SPPoznamka' = MEMPTY, 
    '50SPKlicovaSlova' = MEMPTY,
    '51pojistnaCena' = MEMPTY, '52pojistnaCenaMena' = MEMPTY, # POJISTENI 
    '53pojistnaCenaDatum' = MEMPTY,'54ucetniCena' = MEMPTY,   # CENA
    '55SPDatumPosledniManipulace' = MEMPTY,
    
    '56text1' = MEMPTY, '57text2' = MEMPTY, '58text3' = Plus1T_S,
    '59text4' = Plus2T_S,'60text5' = MEMPTY, '61text6' = MEMPTY,
    '62text7' = MEMPTY, '63text8' = MEMPTY,'64text9' = MEMPTY,
    '65text10' = MEMPTY,'66priznak1' = MEMPTY, '67priznak2' = MEMPTY,
    '68priznak3' = MEMPTY, '69priznak4' = MEMPTY,'70priznak5' = MEMPTY,
    
    '71zpusobNabytiKod' = ZpAkv_AQ,               # NABYTI
    '72nabytiPredmetuDatum' = '72nabytiPredmetuDatum', 
    '73nabytiPredmetuRokAkvizice' = MEMPTY,
    '74nabytiPredmetuDoklad' = CDoklAkv_AQ,
    '75nabytiCena' = MEMPTY,
    '76nabytiMena' = MEMPTY,
    '77predchoziMajitelSlovy' = PredMajSlovy_AQ,
    '78puvodniMajitelKod' = MEMPTY,
    '79prispevatelKod' = MEMPTY,
    '80nabytiPoznamka' = Okolnosti_AQ,
    '81lokalitaNalezuNazev' = Lokalita_S,
    '82lokalitaDoplneni' = MEMPTY,
    '83lokalitaOriginalni' = MEMPTY,
    '84nalezKatUzemiNazev' = MEMPTY,
    '85pozemekSlovy' = MEMPTY,
    '86nalezPoznamka' = MEMPTY,
    '87sGPSsirkaNS' = MEMPTY,'88sGPSsirkaStupne' = MEMPTY,
    '89sGPSsirkaMinuty' = MEMPTY,'90sGPSsirkaVteriny' = MEMPTY,
    '91sGPSdelkaEW' = MEMPTY,'92sGPSdelkaStupne' = MEMPTY,
    '93sGPSdelkaMinuty' = MEMPTY,'94sGPSdelkaVteriny' = MEMPTY,
    '95sGPSvyska' = MEMPTY,'96nalezSouradniceY' = MEMPTY,
    '97nalezSouradniceX' = MEMPTY,'98nalezSouradniceH' = MEMPTY,
    '99souradniceZdroj' = MEMPTY,'100souradnicePresnost' = MEMPTY,
    '101odborneUrceniHmotnost' = MEMPTY,
    
    '102numOuHodnota' = MEMPTY,
    '103numOudobaPlatnosti' = MEMPTY,
    '104numOuStatKod' = MEMPTY,
    '105numOuZeme' = MEMPTY,
    '106numOuTyp' = MEMPTY,
    '107numOuPopisHrana' = MEMPTY,
    
    '108milDruh' = MEMPTY,
    '109milVzor' = MEMPTY,
    '110milRaze' = MEMPTY,
    '111milVyrobniCislo' = MEMPTY,
    '112milKategorie' = MEMPTY,
    '113milPrukaz' = MEMPTY,
    '114milMistoUziti' = MEMPTY,
    
    '115rokPrirust' = MEMPTY,'116mnozstviSlovy' = MEMPTY,
    '117pocetCasti' = MEMPTY,'118popisCasti' = MEMPTY)

oper_obp <- mus_tab

# S A V E   I M P O R T   C S V

save <- paste0(path_csv, spravce, "_import_obp.csv")

if(file.exists(save)){
  print("You've been here before!")
} else {
  write.table(mus_tab, file = save, 
            sep = ";", quote = T, row.names = F, 
            na = "", fileEncoding="cp1250")
  print("Import written, baby!")
}

```

Import prvnich 10 zaznamu. Zkouska, zda sedi pocet a format sloupcu apod.    

```{r TOP 10 ENTRIES TRIAL}

mus_tab_cvic <- mus_tab %>% 
  slice(1:10)

# S A V E   I M P O R T   C S V

save_cv <- paste0(path_csv, spravce, "_import_obp_CVICNE.csv")

if(file.exists(save_cv)){
  print("You've been here before!")
} else {
  write.table(mus_tab, file = save_cv, 
            sep = ";", quote = T, row.names = F, 
            na = "", fileEncoding="cp1250")
  print("Import written, baby!")
  }
```

! ! ! ! ! PAR, VUM, FOT, BIO, BR = n e a k t u a l i z o v a n e ! ! ! ! ! 

## PAR

**DEMUS**: Sbirky 
**MUSEION**: import_par.csv

**IMPORTNÍ ROZHRANNÍ**: CSV PAR


```{r MODIFY TABLE SBIRKY FOR PAR, eval = F}

modify_tab <- demus_tab %>% 
  mutate(MEMPTY = "") %>% 
  mutate('1typPredmetuKod' = "PA") %>%            # !! povinne !! "PA", "AU"
  mutate('2sbirkaCisloEvidInt' = sbirka) %>% 
  mutate('3podsbirkaCislo' = podsbirka) %>% 
  mutate('16fondKod' = case_when(
    Fond_S == "Filatelie a pohlednice" ~ "FP",
    Fond_S == "Military" ~ "M",
    Fond_S == "Plakáty" ~ "P",
    Fond_S == "Výtvarné umění" ~ "VU"
    ))
  
# n = 

# create CSV

mus_tab <- modify_tab %>% 
  select(
    '1typPredmetuKod' = '1typPredmetuKod', '2sbirkaCisloEvidInt'= '2sbirkaCisloEvidInt',
    '3podsbirkaCislo' = '3podsbirkaCislo', '4ciselnaRadaKod'= Rada_S,
    
    '5SPCislo' = MINVC, '6SPPoradoveCislo'= PorC_S, '7SPPoradoveCisloSub' = MSUB,
    '8SPCisloDo'= MINVCDO, '9SPPoradoveCisloDo'= HPorC_S, '10SPPoradoveCisloSubDo' = MSUBDO,
    
    '11SPDatumZapisu' = DatZap_S, '12cisloCES' = MEMPTY,
    '13prirustekCislo' = Plus2T_S,'14ciselnaRadaPrirustkuKod' = MEMPTY,
    '15nabytiPrirustkuDatum' = MEMPTY,'16fondKod' = '16fondKod',
    '17skupinaKod' = Skupina_S,
    '18podskupina1Kod' = MEMPTY, '19podskupina2Kod' = MEMPTY,'20podskupina3Kod' = MEMPTY,
    '21SPPocetKusu' = Pocet_S,'22jinaEvidence1Cislo' = MEMPTY,
    '23jinaEvidence2Cislo' = MEMPTY,'24jinaEvidence3Cislo' = JineC_S,
    '25SPPapirovaKarta' = Karta_S,'26SPKartaJeOpsana' = Opsana_S, # LOGICKA POLE
    '27materialovaSkupinaKod' =  MEMPTY,
    '28SPUIns' = Zapsal_S, '29SPDIns' = DatZap_S, # ZALOZENI ZAZNAMU
    '30SPUUpd' = MEMPTY, '31SPDUpd' = DatZm_S, # UPRAVA ZAZNAMU 
    '32stalaLokaceKod' = StLokace_S, '33aktualniLokaceKod' = AktLokace_S, # LOKACE
    '34predmetNazev' = Titul_S, '35oznaceni1Nazev' = Predmet_S, # PREDMET
    
    '36odborneUrceniPopis' = Popis_S, '37odborneUrceniPoznamka' = MEMPTY, 
    '38kompletnostKod' = MEMPTY, '39signatura' = MEMPTY,
    '40markant' = Sign_S, '41jazykSlovy' = MEMPTY, '42urcilOsobaKod' = Markant_S,
    '43dataceUrceniHodnota' = MEMPTY,'44odborneUrceniSchvaleno' = Urcil_S,
    '45schvalilOsobaKod' = DatUrc_S, '46datumSchvaleni' = MEMPTY,
    '47SPPoznamka' = MEMPTY,'48SPKlicovaSlova' = MEMPTY,
    
    '49pojistnaCena' = MEMPTY, '50pojistnaCenaMena' = MEMPTY,  # POJISTENI 
    '51pojistnaCenaDatum' = MEMPTY, '52ucetniCena' = MEMPTY, 
    '53SPDatumPosledniManipulace' = MEMPTY,
    
    '54text1' = MEMPTY, '55text2' = MEMPTY, '56text3' = MEMPTY, 
    '57text4' = MEMPTY, '58text5' = MEMPTY, '59text6' = MEMPTY,
    '60text7' = MEMPTY, '61text8' = MEMPTY, '62text9' = MEMPTY, '63text10' = MEMPTY,
    '64priznak1' = MEMPTY, '65priznak2' = MEMPTY,'66priznak3' = MEMPTY, 
    '67priznak4' = MEMPTY, '68priznak5' = MEMPTY,
    
    '69zpusobNabytiKod' = MEMPTY,'70nabytiPredmetuDatum' = MEMPTY,    # NABYTI
    '71nabytiPredmetuRokAkvizice' = MEMPTY,'72nabytiPredmetuDoklad' = MEMPTY, 
    '73nabytiCena' = MEMPTY,'74nabytiMena' = MEMPTY,
    '75predchoziMajitelSlovy' = MEMPTY,'76puvodniMajitelKod' = MEMPTY,
    '77prispevatelKod' = MEMPTY,'78nabytiPoznamka' = MEMPTY,
    
    '79lokalitaNalezuNazev' = MEMPTY,'80nalezKatUzemiNazev' = MEMPTY,   # LOKALITA
    '81pozemekSlovy' = Lokalita_S,'82nalezPoznamka' = MEMPTY,
    '83nalezGPSsirka' = MEMPTY,'84nalezGPSdelka' = MEMPTY,
    '85nalezGPSvyska' = MEMPTY,'86nalezSouradniceY' = MEMPTY,
    '87nalezSouradniceX' = MEMPTY,'88nalezSouradniceH' = MEMPTY,
    '89souradniceZdroj' = MEMPTY,'90souradnicePresnost' = MEMPTY,
    '91druhCislovaniParcelKod' = MEMPTY,'92pozemekKod' = MEMPTY,
    
    '93nalezArcheologieSouradniceSJTSK' = MEMPTY,'94nalezArcheologieNazevVyzkumu' = MEMPTY,
    '95nalezArcheologieRokVyzkumu' = MEMPTY,'96nalezArcheologieFirmaVyzkumu' = MEMPTY,
    '97nalezArcheologieVedouciVyzkumu' = MEMPTY,'98nalezCisloNalezoveZpravy' = MEMPTY,
    '99nalezArcheologieCiziVyzkum' = MEMPTY,'100nalezMisto' = MEMPTY,
    '101nalezKontext' = MEMPTY,'102nalezArcheologieKontext2' = MEMPTY,
    '103nalezArcheologieKontext3' = MEMPTY,'104nalezArcheologieKomponenta' = MEMPTY,
    '105nalezHloubka' = MEMPTY,'106nalezKraj' = MEMPTY,
    '107nalezOkres' = MEMPTY,'108nalezObec' = MEMPTY,
    '109nalezObecPuvodni' = MEMPTY,'110nalezCastObce' = MEMPTY,
    '111nalezMestskaCast' = MEMPTY,'112nalezCisloPopis' = MEMPTY,
    '113nalezUlice' = MEMPTY,'114nalezCisloOrient' = MEMPTY,
    '115nalezPSC' = MEMPTY,'116nalezKodStatu' = MEMPTY,
    
    '117rokPrirustku' = MEMPTY,'118mnozstviSlovy' = MEMPTY, 
    '119pocetCasti' = MEMPTY,'120popisCasti' = MEMPTY) %>% 
  mutate_all( ~ str_replace_all(., pattern = ";", replacement = " ")) %>%  # removes semicolons
  mutate_all( ~ str_replace_all(., pattern = "[\r\n]", replacement = " ")) #removes paragraphs

# convert FALSE to 0, TRUE to 1

mus_tab$'25SPPapirovaKarta' <- as.integer(as.logical(mus_tab$'25SPPapirovaKarta')) 
mus_tab$'26SPKartaJeOpsana' <- as.integer(as.logical(mus_tab$'26SPKartaJeOpsana'))

write.table(mus_tab, paste0(path_csv, project, "_import_par.csv"), 
            sep = ";", quote = T, row.names = F, 
            na = "", fileEncoding="cp1250")
```

## VUM

**DEMUS**: Sbirky 
**MUSEION**: import_vum.csv

**IMPORTNÍ ROZHRANNÍ**: CSV VUM


```{r MODIFY TABLE SBIRKY FOR VUM, eval = F}

modify_tab <- demus_tab %>% 
  mutate(MEMPTY = "") %>% 
  mutate('1sbirkaCisloEvidInt' = sbirka) %>% 
  mutate('2podsbirkaCislo' = podsbirka) %>% 
  mutate('16fondKod' = case_when(
    Fond_S == "Filatelie a pohlednice" ~ "FP",
    Fond_S == "Military" ~ "M",
    Fond_S == "Plakáty" ~ "P",
    Fond_S == "Výtvarné umění" ~ "VU"
    ))
  
# n = 

# create CSV

mus_tab <- modify_tab %>% 
  select(
    '1sbirkaCisloEvidInt'= '1sbirkaCisloEvidInt', '2podsbirkaCislo' = '2podsbirkaCislo',
    '3ciselnaRadaKod'= Rada_S, '4SPCislo' = MINVC, 
    '5SPcisloCES' = MEMPTY, '6SPPoradoveCislo' = MEMPTY,    
    '7SPCisloDo' = MEMPTY, '8SPPoradoveCisloDo' = MEMPTY,    
    '9SPPoradoveCisloSub' = MEMPTY, '10SPPoradoveCisloSubDo' = MEMPTY,    
    '11SPDatumZapisu' = MEMPTY, '12odborneUrceniSchvaleno' = MEMPTY,    
    '13jinaEvidence1Cislo' = MEMPTY, '14jinaEvidence2Cislo' = MEMPTY,    
    '15jinaEvidence3Cislo' = MEMPTY, '16fondKod' = MEMPTY,    
    '17skupinaKod' = MEMPTY, '18podskupinaKod' = MEMPTY,    
    '19oznaceniNazev' = MEMPTY, '20SPPocetKusu' = MEMPTY, 
    
    '21pojistnaCena' = MEMPTY, '22pojistnaCenaMena' = MEMPTY,    
    '23pojistneCenaDatum' = MEMPTY, '24ucetniCena' = MEMPTY, 
    '25podskupina2Kod' = MEMPTY, '26podskupina3Kod' = MEMPTY,    
    '27SPPapirovaKarta' = MEMPTY, '28SPKartaJeOpsana' = MEMPTY,    
    '29urcilOsobaKod' = MEMPTY, '30dataceUrceniHodnota' = MEMPTY,    
    '31odborneUrceniPoznamka' = MEMPTY, '32odborneUrceniPopis' = MEMPTY,    
    '33odborneUrceniPopis2' = MEMPTY, '34lokalitaNalezuNazev' = MEMPTY,    
    '35lokalitaDoplneni' = MEMPTY, '36rokPrirustku' = MEMPTY,    
    '37puvodnost' = MEMPTY, '38zpusobAdjustace' = MEMPTY,    
    '39popisAdjustace' = MEMPTY, '40signatura' = MEMPTY,    
    '41markant' = MEMPTY, '42stupenZpracovani' = MEMPTY,    
    '43povahaZpracovani' = MEMPTY, '44sloh' = MEMPTY,    
    '45datumExpirace' = MEMPTY, '46stalaLokaceKod' = MEMPTY,    
    '47aktualniLokaceKod' = MEMPTY, '48SPPoznamka' = MEMPTY,    
    '49archivalie' = MEMPTY, '50zpusobNabytiKod' = MEMPTY,    
    '51nabytiPredmetuDatum' = MEMPTY, '52nabytiPredmetuDoklad' = MEMPTY,    
    '53nabytiPoznamka' = MEMPTY, '54nabytiPredchoziMajitelSlovy' = MEMPTY,    
    '55nabytiPredmetuRokAkvizice' = MEMPTY, '56nabytiCena' = MEMPTY,    
    '57nabytiMena' = MEMPTY, '58prirustekCislo' = MEMPTY,    
    '59ciselnaRadaPrirustkuKod' = MEMPTY, '60nabytiPrirustkuDatum' = MEMPTY,    
    '61schvalilOsobaKod' = MEMPTY, '62datumSchvaleni' = MEMPTY,    
    '63volne' = MEMPTY, '64SPDatumPosledniManipulace' = MEMPTY,    
    '65text1' = MEMPTY, '66text2' = MEMPTY, '67text3' = MEMPTY, 
    '68text4' = MEMPTY, '69text5' = MEMPTY, 
    '70SPpriznak1' = MEMPTY, '71SPpriznak2' = MEMPTY, 
    '72SPUIns' = MEMPTY, '73SPDIns' = MEMPTY, 
    '74SPUUpd' = MEMPTY,  '75SPDUpd' = MEMPTY, 
    '76puvodniMajitelKod' = MEMPTY, '77prispevatelKod' = MEMPTY, 
    '78text6' = MEMPTY,  '79text7' = MEMPTY, '80text8' = MEMPTY,     
    '81text9' = MEMPTY, '82text10' = MEMPTY,     
    '83priznak3' = MEMPTY, '84priznak4' = MEMPTY, '85priznak5' = MEMPTY, 
    '86mnozstviSlovy' = MEMPTY, '87pocetCasti' = MEMPTY, '88popisCasti' = MEMPTY) %>% 
  mutate_all( ~ str_replace_all(., pattern = ";", replacement = " ")) %>%  # removes semicolons
  mutate_all( ~ str_replace_all(., pattern = "[\r\n]", replacement = " ")) #removes paragraphs

# convert FALSE to 0, TRUE to 1

mus_tab$'27SPPapirovaKarta' <- as.integer(as.logical(mus_tab$'27SPPapirovaKarta')) 
mus_tab$'28SPKartaJeOpsana' <- as.integer(as.logical(mus_tab$'28SPKartaJeOpsana'))

write.table(mus_tab, paste0(path_csv, project, "_import_vum.csv"), 
            sep = ";", quote = T, row.names = F, 
            na = "", fileEncoding="cp1250")

```


## FOT

**DEMUS**: Sbirky 
**MUSEION**: import_fot.csv

**IMPORTNÍ ROZHRANNÍ**: CSV FOT


```{r MODIFY TABLE SBIRKY FOR FOT, eval = F}

modify_tab <- demus_tab %>% 
  mutate(MEMPTY = "") %>% 
  mutate('1sbirkaCisloEvidInt' = sbirka) %>% 
  mutate('2podsbirkaCislo' = podsbirka) %>% 
  mutate('15fondKod' = case_when(
    Fond_S == "Filatelie a pohlednice" ~ "FP",
    Fond_S == "Military" ~ "M",
    Fond_S == "Plakáty" ~ "P",
    Fond_S == "Výtvarné umění" ~ "VU"
    ))
  
# n = 

# create CSV

mus_tab <- modify_tab %>% 
  select(
    '1sbirkaCisloEvidInt'= '1sbirkaCisloEvidInt',      # !! povinne !! ze slovniku
    '2podsbirkaCislo' = '2podsbirkaCislo',             # !! povinne !! ze slovniku
    '3ciselnaRadaKod'= Rada_S,                         # !! povinne !! ze slovniku
    '4SPCislo' = MINVC,                                # !! povinne !!
    '5SPcisloCES' = MEMPTY, '6SPPoradoveCislo' = MEMPTY,    
    '7SPCisloDo' = MEMPTY, '8SPPoradoveCisloDo' = MEMPTY,    
    '9SPPoradoveCisloSub' = MEMPTY, '10SPPoradoveCisloSubDo' = MEMPTY,    
    '11SPDatumZapisu' = MEMPTY, '12jinaEvidence1Cislo' = MEMPTY,    
    '13jinaEvidence2Cislo' = MEMPTY, '14jinaEvidence3Cislo' = MEMPTY,    
    '15fondKod' = '15fondKod', '16skupinaKod' = MEMPTY,    
    '17oznaceniNazev' = MEMPTY, '18materialNazev' = MEMPTY,    
    '19predmetNazev' = MEMPTY, '20SPPocetKusu' = MEMPTY, 
    '21volne' = MEMPTY, '22SPPapirovaKarta' = MEMPTY,    
    '23SPKartaJeOpsana' = MEMPTY, '24urcilOsobaKod' = MEMPTY, 
    '25dataceUrceniHodnota' = MEMPTY, '26odborneUrceniPoznamka' = MEMPTY,    
    '27odborneUrceniPopis' = MEMPTY, '28odborneUrceniPopis2' = MEMPTY,    
    '29lokalitaVzniku' = MEMPTY, '30vznikPredmetuMisto' = MEMPTY,    
    '31lokalitaNalezuNazev' = MEMPTY, '32rokPrirustku' = MEMPTY,    
    '33puvodnost' = MEMPTY, '34zpusobAdjustace' = MEMPTY,    
    '35popisAdjustace' = MEMPTY, '36signatura' = MEMPTY,    
    '37signatura2' = MEMPTY, '38markant' = MEMPTY,    
    '39format' = MEMPTY, '40povrch' = MEMPTY,    
    '41barva' = MEMPTY, '42orientace' = MEMPTY,    
    '43citelnost' = MEMPTY, '44zoom' = MEMPTY,    
    '45stalaLokaceKod' = MEMPTY, '46aktualniLokaceKod' = MEMPTY,    
    '47SPPoznamka' = MEMPTY, '48archivalie' = MEMPTY,    
    '49zpusobNabytiKod' = MEMPTY, '50nabytiPredmetuDatum' = MEMPTY,    
    '51nabytiPredmetuDoklad' = MEMPTY, '52nabytiPoznamka' = MEMPTY,    
    '53predchoziMajitelSlovy' = MEMPTY, '54prirustekCislo' = MEMPTY,    
    '55ciselnaRadaPrirustkuKod' = MEMPTY, '56nabytiPrirustkuDatum' = MEMPTY,    
    '57pojistnaCena' = MEMPTY, '58pojistnaCenaMena' = MEMPTY,    
    '59pojistnaCenaDatum' = MEMPTY, '60ucetniCena' = MEMPTY,    
    '61text1' = MEMPTY, '62text2' = MEMPTY,    
    '63text3' = MEMPTY, '64text4' = MEMPTY, '65text5' = MEMPTY,
    '66SPUIns' = MEMPTY, '67SPDIns' = MEMPTY, 
    '68SPUUpd' = MEMPTY, '69SPDUpd' = MEMPTY, 
    '70odborneUrceniSchvaleno' = MEMPTY, '71schvalilOsobaKod' = MEMPTY, 
    '72datumSchvaleni' = MEMPTY, '73nabytiPredmetuRokAkvizice' = MEMPTY, 
    '74nabytiCena' = MEMPTY,  '75nabytiMena' = MEMPTY, 
    '76puvodniMajitelKod' = MEMPTY, '77prispevatelKod' = MEMPTY, 
    '78podskupina1Kod' = MEMPTY,  '79podskupina2Kod' = MEMPTY, '80podskupina3Kod' = MEMPTY,     
    '81text6' = MEMPTY, '82text7' = MEMPTY,     
    '84text9' = MEMPTY, '85text10' = MEMPTY, 
    '85priznak5' = MEMPTY, '86priznak1' = MEMPTY, 
    '87priznak2' = MEMPTY, '88priznak3' = MEMPTY,
    '89priznak4' = MEMPTY, '90priznak5' = MEMPTY,
    '91mnozstviSlovy' = MEMPTY, '92pocetCasti' = MEMPTY, '93popisCasti' = MEMPTY) %>% 
  mutate_all( ~ str_replace_all(., pattern = ";", replacement = " ")) %>%  # removes semicolons
  mutate_all( ~ str_replace_all(., pattern = "[\r\n]", replacement = " ")) #removes paragraphs

# convert FALSE to 0, TRUE to 1

mus_tab$'22SPPapirovaKarta' <- as.integer(as.logical(mus_tab$'22SPPapirovaKarta')) 
mus_tab$'23SPKartaJeOpsana' <- as.integer(as.logical(mus_tab$'23SPKartaJeOpsana')) 

write.table(mus_tab, paste0(path_csv, project, "_import_fot.csv"), 
            sep = ";", quote = T, row.names = F, 
            na = "", fileEncoding="cp1250")

```


\newpage


## BIO

**DEMUS**: Sbirky 
**MUSEION**: import_bio.csv

**IMPORTNÍ ROZHRANNÍ**: CSV BIO


```{r MODIFY TABLE SBIRKY FOR BIO}

modify_tab <- demus_tab %>% 
  mutate(MEMPTY = "") %>% 
  mutate('1typPredmetuKod' = "BI")   %>% # povinný - "BI", "BO", "ZO", "EN", "GE", "PL"
  mutate('2sbirkaCisloEvidInt' = sbirka) %>% 
  mutate('3podsbirkaCislo' = podsbirka) %>% 
  mutate('16fondKod' = case_when(
    Fond_S == "Filatelie a pohlednice" ~ "FP",
    Fond_S == "Military" ~ "M",
    Fond_S == "Plakáty" ~ "P",
    Fond_S == "Výtvarné umění" ~ "VU"
    ))
  
# n = 

# create CSV

mus_tab <- modify_tab %>% 
  select(
    '1typPredmetuKod' = '1typPredmetuKod',        # !! povinne !!
    '2sbirkaCisloEvidInt'= '2sbirkaCisloEvidInt', # !! povinne !! ze slovniku
    '3podsbirkaCislo' = '3podsbirkaCislo',        # !! povinne !! ze slovniku
    '4ciselnaRadaKod'= Rada_S,                    # !! povinne !! ze slovniku
    
    '5SPCislo' = MINVC,                           # !! povinne !!
    '6SPcisloCES'= PorC_S, 
    '7SPPoradoveCislo' = MSUB,
    '8SPCisloDo'= MINVCDO, 
    '9SPPoradoveCisloDo'= HPorC_S, 
    '10SPPoradoveCisloSub' = MSUBDO,
    '11SPPoradoveCisloSubDo' = DatZap_S, 
    
    '12SPDatumZapisu' = MEMPTY, '13jinaEvidence1Cislo' = Plus2T_S,
    '14jinaEvidence2Cislo' = MEMPTY,'15jinaEvidence3Cislo' =  MEMPTY,
    '16fondKod' = '16fondKod', '17skupinaKod' = Skupina_S,
    '18materialovaSkupinaKod' = MEMPTY, '19oznaceniNazev' = MEMPTY,'20taxon' = MEMPTY,
    '21snadTaxon' = Pocet_S, '22SPPocetKusu' = MEMPTY,
    '23urcilOsobaKod' = MEMPTY,'24dataceUrceniHodnota' = JineC_S,
    '25odborneUrceniPoznamka' = Karta_S, '26odborneUrceniPopis' = Opsana_S, 
    
    '27lokalita' = Archiv_S,                            # LOKALITA
    '28sirkaNS' = Zapsal_S, '29sirkaStupne' = DatZap_S, 
    '30sirkaMinuty' = MEMPTY, '31sirkaVteriny' = DatZm_S, # UPRAVA ZAZNAMU 
    '32delkaEW' = StLokace_S, '33delkaStupne' = AktLokace_S, # LOKACE
    '34delkaMinuty' = Titul_S, '35delkaVteriny' = Predmet_S, # PREDMET
    '36vyska' = Popis_S, '37specifikaceLokality' = MEMPTY, 
    '38mapa' = MEMPTY, '39ctverec' = MEMPTY,
    
    '40charakteristika' = Sign_S, '41puvodniPopisLokality' = MEMPTY,
    '42nadmorskaVyska' = Markant_S, '43nalezPoznamka' = MEMPTY,
    '44dataceHodnota' = Urcil_S, '45datacePoznamka' = DatUrc_S, 
    '46textEtiketa' = MEMPTY, '47typ' = MEMPTY,
    '48cf' = MEMPTY, '49var' = MEMPTY, 
    '50herbar' = MEMPTY, '51preparat' = MEMPTY, 
    '52pocetSamcu' = MEMPTY, '53pocetSamic' = MEMPTY, '54pocetJuv' = MEMPTY, # CENA
    '55collectio' = MEMPTY,
    
    '56stalaLokaceKod' = MEMPTY, '57aktualniLokaceKod' = MEMPTY, 
    
    '58SPPoznamka' = MEMPTY,
    '59zpusobNabytiKod' = MEMPTY,'60nabytiPredmetuDatum' = MEMPTY, 
    '61nabytiPredmetuDoklad' = MEMPTY, '62nabytiPoznamka' = MEMPTY, 
    '63nabytiPredchoziMajitelSlovy' = MEMPTY,'64prirustekCislo' = MEMPTY,
    '65ciselnaRadaPrirustkuKod' = MEMPTY,'66nabytiPrirustkuDatum' = MEMPTY, 
    '67zakladniCharakteristika' = MEMPTY, '68kodPodskupiny1' = MEMPTY, 
    '69kodPodskupiny2' = MEMPTY,'70kodPodskupiny3' = MEMPTY,
    '71predmetCizi' = MEMPTY,
    '72SPPapirovaKarta' = MEMPTY, '73SPKartaJeOpsana' = MEMPTY,
    '74text1' = MEMPTY, '75text2' = MEMPTY, '76text3' = MEMPTY,
    '77text4' = MEMPTY ,'78text5' = MEMPTY,
    '79SPUIns' = MEMPTY,'80SPDIns' = MEMPTY,
    '81SPUUpd' = Lokalita_S,'82SPDUpd' = MEMPTY,
    
    '83parageneze' = MEMPTY,'84chronostratigrafie' = MEMPTY,
    '85litostratigrafie' = MEMPTY,'86poznamkaChrono' = MEMPTY,
    '87poznamkaLito' = MEMPTY,'88kompletnost' = MEMPTY,
    '89tvar' = MEMPTY,'90barva' = MEMPTY,
    '91zrnitost' = MEMPTY,'92biozona' = MEMPTY,
    '93fertilita' = MEMPTY,'94zpusobZachovani' = MEMPTY,
    '95originalniJmeno' = MEMPTY,'96zoPohlavi' = MEMPTY,
    '97zoStari' = MEMPTY,'98snadChrono' = MEMPTY,
    '99snadLito' = MEMPTY, '100klicovaSlova' = MEMPTY,
    '101nazevKU' = MEMPTY, '102fytochorion' = MEMPTY,
    '103lokalitaDoplneni' = MEMPTY, '104lokalitaOriginalni' = MEMPTY,
    '105stanoviste' = MEMPTY, '106mikroStanoviste' = MEMPTY,
    '107biotopKod' = MEMPTY, '108zpusobZiskani' = MEMPTY,
    '109souradniceZdroj' = MEMPTY, '110souradnicePresnost' = MEMPTY,
    '111cisloSberu' = MEMPTY, '112rokAkvizice' = MEMPTY,
    '113text6' = MEMPTY, '114text7' = MEMPTY,
    '115text8' = MEMPTY, '116text9' = MEMPTY,
    '117text10' = MEMPTY, '118rokPrirustku' = MEMPTY,
    '119kategorieTaxonuNazev' = MEMPTY, '120nadrizenyTaxonNom' = MEMPTY) %>% 
  mutate_all( ~ str_replace_all(., pattern = ";", replacement = " ")) %>%  # removes semicolons
  mutate_all( ~ str_replace_all(., pattern = "[\r\n]", replacement = " ")) #removes paragraphs
  
# convert FALSE to 0, TRUE to 1

mus_tab$'72SPPapirovaKarta' <- as.integer(as.logical(mus_tab$'72SPPapirovaKarta')) 
mus_tab$'73SPKartaJeOpsana' <- as.integer(as.logical(mus_tab$'73SPKartaJeOpsana'))

write.table(mus_tab, paste0(path_csv, project, "_import_bio.csv"), 
            sep = ";", quote = T, row.names = F, 
            na = "", fileEncoding="cp1250")

```


## BR

**DEMUS**: Sbirky 
**MUSEION**: import_br.csv

**IMPORTNÍ ROZHRANNÍ**: CSV BR


```{r MODIFY TABLE SBIRKY FOR BR}

modify_tab <- demus_tab %>% 
  mutate(MEMPTY = "") %>% 
  mutate('1typSbirkyNazev' = "")   # povinný, ze slovníku; lze zapsat i plnou hierarchii

# n = 

# create CSV

mus_tab <- modify_tab %>% 
  select(
    '1typSbirkyNazev' = MEMPTY,    # !! povinne !!
    '2isbn' = MEMPTY,              # !! povinne !!
    '3inventarniCislo' = MEMPTY, 
    '4predmetNazev' = MEMPTY,      # !! povinne !!
    '5popisPredmetu' = MEMPTY,     # !! povinne !!
    '6altNazev' = MEMPTY,
    '7autorDila' = MEMPTY, '8editor' = MEMPTY,
    '9ilustrator' = MEMPTY, '10fotograf' = MEMPTY,
    '11grafik' = MEMPTY, '12sazec' = MEMPTY,
    '13redaktor' = MEMPTY, '14nakladatelstvi' = MEMPTY,
    '15vek30' = MEMPTY, '16datumVydani' = MEMPTY,
    '17poradiVydani' = MEMPTY, '18pocetStran' = MEMPTY,
    '19rozmery' = MEMPTY, '20pismo' = MEMPTY,
    '21naklad' = MEMPTY, '22jazykDokumentu' = MEMPTY,
    '23prodejniCena' = MEMPTY, '24tiskarna' = MEMPTY,
    '25poznamka' = MEMPTY, '26prihlasovatel' = MEMPTY,
    '27prihAdresaSlovy' = MEMPTY, '28prihBankSpoj' = MEMPTY,
    '29prihPoIco' = MEMPTY, '30prihPoDic' = MEMPTY,
    '31kontaktOsoba' = MEMPTY, '32koTelefon' = MEMPTY,
    '33koMobil' = MEMPTY, '34koEmail' = MEMPTY,
    
    '35vratitKnihy' = MEMPTY, '36vystavitDoklad' = MEMPTY, # LOGICKA POLE
    '37souhlasGdpr' = MEMPTY, '38souhlasPubl' = MEMPTY,
    
    '39nominaceRok' = MEMPTY, '40nominaceKategorie' = MEMPTY,
    '41oceneniRok' = MEMPTY, '42oceneniKategorie' = MEMPTY,
    '43oceneniMisto' = MEMPTY, '44oceneniTyp' = MEMPTY,
    '45variantaCCLicenceOznaceni' = MEMPTY, '46seznamKontextovychDokumen' = MEMPTY) 
# %>% 
#   mutate_all( ~ str_replace_all(., pattern = ";", replacement = " ")) %>%  # removes semicolons
#   mutate_all( ~ str_replace_all(., pattern = "[\r\n]", replacement = " ")) #removes paragraphs
  
# convert FALSE to 0, TRUE to 1

mus_tab$'35vratitKnihy' <- as.integer(as.logical(mus_tab$'35vratitKnihy')) 
mus_tab$'36vystavitDoklad' <- as.integer(as.logical(mus_tab$'36vystavitDoklad'))
mus_tab$'37souhlasGdpr' <- as.integer(as.logical(mus_tab$'37souhlasGdpr'))
mus_tab$'38souhlasPubl' <- as.integer(as.logical(mus_tab$'38souhlasPubl'))

write.table(mus_tab, paste0(path_csv, project, "_import_br.csv"), 
            sep = ";", quote = T, row.names = F, 
            na = "", fileEncoding="cp1250")
```


# 4. DOPROVODNÉ TABULKY (opakovatelné)

Pro doprovodne tabulky je treba mit jiz pripravene inventarni cislo v konecnem formatu  
(viz sekce *Referencni tabulka Sbirky*)

## Materál předmětu

tabulka s poradim materialu ke konkretnimu predmetu
invc1 - 1. material 1
invc1 - 2. material 2
invc2 - 1. material 1, atd

**DEMUS**: Sbirky  
**MUSEION**: import_matpred.csv  
  
**IMPORTNÍ ROZHRANNÍ**: CSV Materiál předmětu  


```{r DERIVE MATPRED FROM SBIRKY, warning = F}

# M O D I F Y

dopr_tab <- sbirky %>% 
  select(MINVC, Material_S) %>% 
  mutate(MEMPTY = "") %>% 
  mutate('2sbirkaCisloEvidInt' = sbirka) %>% 
  mutate('3podsbirkaCislo' = podsbirka) %>% 
  mutate(MMAT = Material_S) %>% 
  separate(MMAT,into=c("MMAT1", "MMAT2", "MMAT3", "MMAT4", "MMAT5") , sep=",|;") %>% 
  pivot_longer(
    cols = MMAT1:MMAT5, 
    names_to = "MMAT_POR", # poradi materialu
    values_to = "MMAT_AGG",
    values_drop_na = TRUE) %>% 
  mutate(MMATERIAL = str_trim(MMAT_AGG)) %>% # remove white space
  select(-MMAT_AGG) %>% 
  mutate(MMAT_POR = substr(MMAT_POR, 5, 5))

# C R E A T E    C S V

mus_tab <- dopr_tab %>% 
  select(
    '1SPCislo' = MINVC,                                # !! povinne !!
    '2sbirkaCisloEvidInt' = '2sbirkaCisloEvidInt',     # !! povinne !!
    '3podsbirkaCislo' = '3podsbirkaCislo',             # !! povinne !!
    '4poradi' = MMAT_POR,                              # !! povinne !!
    '5materialNazev' = MMATERIAL,                      # !! povinne !!
    '6materialovaSkupina' = MEMPTY, 
    '7materialSpecifikaceNazev' = MEMPTY, '8materialPredmetuPoznam' = MEMPTY)

oper_matpred <- mus_tab

# SAVE IMPORT FILE

save <- paste0(path_csv, spravce, "_import_matpred.csv")

if(file.exists(save)){
  print("You've been here before!")
} else {
  write.table(mus_tab, file = save, 
            sep = ";", quote = T, row.names = F, 
            na = "", fileEncoding="cp1250")
  print("Import written, baby!")
  }

```


## Technika předmětu

tabulka s poradim technik ke konkretnimu predmetu
invc1 - 1. technika 1
invc1 - 2. technika 2
invc2 - 1. technika 1, atd

**DEMUS**: Sbirky 
**MUSEION**: import_techpred.csv  
  
**IMPORTNÍ ROZHRANNÍ**: CSV Technika předmětu  


```{r DERIVE TECHPRED FROM SBIRKY, warning = F}

# M O D I F Y

dopr_tab <- sbirky %>% 
  select(MINVC, Technika_S) %>% 
  mutate(MEMPTY = "") %>% 
  mutate('2sbirkaCisloEvidInt' = sbirka) %>% 
  mutate('3podsbirkaCislo' = podsbirka) %>% 
  mutate(MTECH = Technika_S) %>% 
  separate(MTECH,into=c("MTECH1", "MTECH2", "MTECH3", "MTECH4", "MTECH5"),
           sep=",(?! tuší)") %>% # separator is ',' BUT ONLY IF NOT FOLLOWED BY ' tuší' -> solves a single case of 'kresba tužkou, tuší a bělobou' which should remain as one entry
  pivot_longer(
    cols = MTECH1:MTECH5, 
    names_to = "MTECH_POR", # poradi techniky
    values_to = "MTECH_AGG",
    values_drop_na = TRUE) %>% 
  mutate(MTECHNIKA = str_trim(MTECH_AGG)) %>% # remove white space
  select(-MTECH_AGG) %>% 
  mutate(MTECH_POR = substr(MTECH_POR, 6, 6))

modif_save <- paste0(path_csv, spravce, "_modif_techpred.csv")

if(file.exists(modif_save)){
  print("You've been here before!")
} else {
  write.table(modify_tab, file = modif_save, 
            sep = ";", quote = T, row.names = F, 
            na = "", fileEncoding="cp1250")
  print("Operational file  S A V E D,  my dear!")
  }

# C R E A T E    C S V

mus_tab <- dopr_tab %>% 
  select(
    '1SPCislo' = MINVC,                                # !! povinne !!
    '2sbirkaCisloEvidInt' = '2sbirkaCisloEvidInt',     # !! povinne !!
    '3podsbirkaCislo' = '3podsbirkaCislo',             # !! povinne !!
    '4poradi' = MTECH_POR,                             # !! povinne !!
    '5technikaNazev' = MTECHNIKA,                      # !! povinne !!
    '6materialovaSkupina' = MEMPTY, 
    '7technikaSpecifikaceNazev' = MEMPTY, '8technikaPredmetuPoznam' = MEMPTY)

oper_techpred <- mus_tab

# S A V E   I M P O R T   C S V

save <- paste0(path_csv, spravce, "_import_techpred.csv")

if(file.exists(save)){
  print("You've been here before!")
} else {
  write.table(mus_tab, file = save, 
            sep = ";", quote = T, row.names = F, 
            na = "", fileEncoding="cp1250")
  print("Import written, baby!")
  }

```

## Miry a Rozmery Předmětů

**DEMUS**: Miry ; Rozmery 
**MUSEION**: import_rozmPtu.csv  
  
**IMPORTNÍ ROZHRANNÍ**: CSV Rozměry předmětu 

Miry = data -> CSV Rozmery Predmetu   
Rozmery = slovnik -> rucne nebo CSV Rozmer  


```{r DERIVE MIRY, warning = F}

# L O A D

mir <- read_excel(paste0(path_data, "Miry.xlsx")) %>% 
  mutate(Moper_poradi = seq_along(IdC_MR)) # jen check zachovani originalniho razeni
# roz <- read_excel(paste0(path_data, "Rozmery.xlsx"))
sb <- sbirky %>% 
  select(IdC_S, MINVC)

# M O D I F Y

dopr_tab <- merge(sb, mir, by.x = "IdC_S", by.y = "IdC_MR", 
                   all.y = T, keep = T) %>% 
   mutate(MEMPTY = "",
          MROZMER = case_when(is.na(Rozmer_MR) ~ "x",
                              Rozmer_MR == "s" ~ "š-cm",
                              Rozmer_MR == "v" ~ "v-cm",
                              Rozmer_MR == "h" ~ "h-cm"),
          '2sbirkaCisloEvidInt' = sbirka,  
          '3podsbirkaCislo' = podsbirka, 
          '5rozmerPredmetuHodnota' = round(Mira_MR, 2)) %>% # pokud chybi specifikace rozmeru, importujeme pod 'x'
  group_by(MINVC) %>% 
  mutate(MPORADI = seq_along(Moper_poradi)) %>% 
  ungroup()

modif_save <- paste0(path_csv, spravce, "_modif_rozmPtu.csv")

if(file.exists(modif_save)){
  print("You've been here before!")
} else {
  write.table(modify_tab, file = modif_save, 
            sep = ";", quote = T, row.names = F, 
            na = "", fileEncoding="cp1250")
  print("Operational file  S A V E D,  my dear!")
  }

# C R E A T E    C S V

mus_tab <- dopr_tab %>% 
  select(
    '1SPCislo' = MINVC,                                   # !! povinne !!
    '2sbirkaCisloEvidInt' = '2sbirkaCisloEvidInt',     
    '3podsbirkaCislo' = '3podsbirkaCislo',                # 
    '4rozmerNazev' = MROZMER,                             # !! povinne !!
    '5rozmerPredmetuHodnota' = '5rozmerPredmetuHodnota',  # !! povinne !!
    '6rozmerPredmetuPoznamka' = Pozn_MR, 
    '7$poradi' = MPORADI)                                 # !! povinne !!

oper_rozmPtu <- mus_tab

# S A V E   I M P O R T   C S V

save <- paste0(path_csv, spravce, "_import_rozmPtu.csv.csv")

if(file.exists(save)){
  print("You've been here before!")
} else {
  write.table(mus_tab, file = save, 
            quote = T, row.names = F, 
            sep = ";", dec = ",",              # desetinny oddelovac musi byt carka
            na = "", fileEncoding="cp1250")
  print("Import written, baby!")
  }

```

## Vznik Předmětů

tabulka s trojici ke konkretnimu predmetu
invc1 - 1. autor
invc1 - 2. datace
invc1 - 3. misto vzniku
invc1 - 4. autor 2
invc2 - 1. datace, atd  
  
### kontrola rolí a lokalit

- zkontrolovat ve slovníku role a případně ručně dozaložit chybějící   
- MUSEION -> Slovníky -> Osoby a instituce -> Role subjektů  

```{r CHECK ROLES AND LOCS DICTIONARY, eval = F}

unique(sbirky$Role_S)

unique(oper_lokalita$'1lokalitaNazev')
unique(sbirky$MistoVz_S)

```  

### vznik ptu  


**DEMUS**: Sbirky 
**MUSEION**: import_vznikPtu.csv  
  
**IMPORTNÍ ROZHRANNÍ**: CSV Vznik předmětů  


```{r DERIVE VZNIKPTU FROM SBIRKY, warning = F, eval = F}

# L O A D

# pokud neni jiz nacten v Environmentu

interni_adresar <- read.table(paste0(path_csv, "_NM-HM_INTERNI_ADRESAR.csv"),
                        header = T, sep = ";", fileEncoding="cp1250")

# M O D I F Y

dopr_tab <- sbirky %>% 
  select(MINVC, Autor_S, Role_S, Datace_S, MistoVz_S) %>% 
  mutate(MDATACE = Datace_S) %>% 
  # ?
  mutate(MDAT_QM = ifelse(MDATACE == "?", MDATACE, NA)) %>% 
  # priznak snad   
  mutate(MSNAD = ifelse(str_detect(MDATACE, "^\\?"), "0", 
                        ifelse(str_detect(MDATACE, "\\?$"), "1", "0"))) %>% 
  mutate(MDATACE = ifelse(str_detect(MDATACE, "\\?$"),
                          str_replace(MDATACE, "\\?", ""), MDATACE)) %>% 
  # yyyy
  mutate(MDAT_Y = ifelse(str_detect(MDATACE, "_00_00"),
                         str_replace_all(MDATACE, "_00|-00", ""), NA)) %>% 
  # mm.yyyy
  # mutate(MDAT_YM = ifelse(str_detect(MDATACE,
  #                                    "^([0-9]{4})[_]([0-9]{1})([1-9]{1})[_]00$"),
  #                                   # format(anydate(substring(MDATACE, 1, 7), "%m.%Y")), ""))
  #                                   # substring(format(anydate(MDATACE), "%m.%Y"), 1, 7), ""))
  #                                   format(anydate(MDATACE), "%m.%Y"), ""))
  # mutate(MDAT_YM = format(anydate(MDATACE), "%m.%Y")) %>%
  mutate(MDAT_YM = substring(ifelse(str_detect(MDATACE,
                                             "^([0-9]{4})[_]([0-9]{1})([1-9]{1})[_]00$"),
                                  MDATACE, ""), 1, 7)) %>%
  mutate(MDAT_YM = format(anydate(MDAT_YM), "%m.%Y")) %>%
  
  # dd.mm.yyyy
  mutate(MDAT_YMD = ifelse(str_detect(MDATACE,
                          "^([0-9]{4})[_]([0-9]{2})[_]([0-9]{2})$"), 
                           format(anydate(MDATACE), "%d.%m.%Y"), NA)) %>% 
  
  # yy leta ss stoleti
  mutate(MDAT_LETA = ifelse(str_detect(MDATACE, "^([0-9]{4})[_]XX[_]([0-9]{2})$"),
                                    paste0(substring(MDATACE, 9, 9), "0. léta ",
                                           substring(MDATACE, 3, 4), ". století"), NA)) %>% 
  # poloviny
  mutate(MDAT_2 = ifelse(str_detect(MDATACE, "^00\\d\\d[_]\\d2[_]XX"),
                                    paste0(substring(MDATACE, 6, 6), ". polovina ",
                                           substring(MDATACE, 3, 4), ". století"), NA)) %>%
  # tretiny - NEVYSKYTUJE SE
  mutate(MDAT_3 = ifelse(str_detect(MDATACE, "^00\\d\\d[_]\\d3[_]XX"),
                                    paste0(substring(MDATACE, 6, 6), ". třetina ",
                                           substring(MDATACE, 3, 4), ". století"), NA)) %>%
  # poloviny - NEVYSKYTUJE SE
  mutate(MDAT_4 = ifelse(str_detect(MDATACE, "^00\\d\\d[_]\\d3[_]XX"),
                                    paste0(substring(MDATACE, 6, 6), ". čtvrtina ",
                                           substring(MDATACE, 3, 4), ". století"), NA)) %>% 
  # tretina roku
  mutate(MDAT_3r = ifelse(str_detect(MDATACE, "^\\d([1-9]{2})\\d[_]\\d3[_]XX"),
                                    paste0(substring(MDATACE, 6, 6), ". třetina roku ",
                                           substring(MDATACE, 1, 4)), NA)) %>% 
  
  # DATACE FINAL
  mutate(MDATACE_MERG = coalesce(MDAT_QM, MDAT_Y, MDAT_YM, MDAT_YMD, MDAT_LETA, MDAT_2, MDAT_3r)) %>% 
  mutate(MDATACE_FIN = coalesce(MDATACE_MERG, MDATACE)) %>% 
  select(-c(MDAT_QM, MDAT_Y, MDAT_YM, MDAT_YMD, MDAT_LETA, MDAT_2, MDAT_3, MDAT_4, MDAT_3r,
            Datace_S, MDATACE, MDATACE_MERG)) 
  

# join interni adresar to deal with new name codes
dopr_tab2 <- merge(dopr_tab, interni_adresar, by.x = "Autor_S", by.y = "puvkod", 
                   all.x = T, keep = T) %>% 
  mutate('3$autorSubjektKod' = ifelse(Autor_S == "neznámý", "neznámý", novykod))


modify_tab <- dopr_tab2 %>% 
  pivot_longer(
    cols = c('3$autorSubjektKod', MDATACE_FIN, MistoVz_S),
    names_to = "MCAT", # poradi materialu
    values_to = "MVAL",
    values_drop_na = TRUE) %>%
  group_by(MINVC) %>%
  mutate(MPORADI = row_number()) %>%
  ungroup() %>%
  pivot_wider(
    names_from = MCAT, values_from = MVAL) %>%
  mutate(MEMPTY = "", 
         '5autorRoleNazev' = ifelse(MPORADI == "1", Role_S, NA))

modif_save <- paste0(path_csv, spravce, "_modif_vznikPtu.csv")

if(file.exists(modif_save)){
  print("You've been here before!")
} else {
  write.table(modify_tab, file = modif_save, 
            sep = ";", quote = T, row.names = F, 
            na = "", fileEncoding="cp1250")
  print("Operational file  S A V E D,  my dear!")
  }

# C R E A T E    C S V

mus_tab <- modify_tab %>% 
  select(
    '1SPCislo' = MINVC,                          # !! povinne !!
    '2poradi' = MPORADI,                         # !! povinne !!
    '3$autorSubjektKod' = '3$autorSubjektKod',             
    '4autorSnad' = MEMPTY,                       # priznak 0 1                        
    '5autorRoleNazev' = '5autorRoleNazev',          
    '6autorPoznamka' = MEMPTY, 
    '7mistoLokalitaNazev' = MistoVz_S, 
    '8mistoSnad' = MEMPTY,                       # priznak 0 1 
    '9specifikaceMistaNazev' = MEMPTY, 
    '10mistoDoplneni' = MEMPTY, 
    '11dataceHodnota' = MDATACE_FIN, 
    '12datacePoznamka' = MEMPTY, 
    '13poznamka' = MEMPTY, 
    '14kvalifikatorDatace' = MEMPTY, 
    '15dataceSnad' = MSNAD,                      # priznak 0 1 
    '16kvalifikatorDatace2' = MEMPTY,  
    '17dataceSnad' = MEMPTY)                     # priznak 0 1  

oper_vznikPtu <- mus_tab

# S A V E   I M P O R T   C S V

save <- paste0(path_csv, spravce, "_import_vznikPtu.csv")

if(file.exists(save)){
  print("You've been here before!")
} else {
  write.table(mus_tab, file = save, 
            sep = ";", quote = T, row.names = F, 
            na = "", fileEncoding="cp1250")
  print("Import written, baby!")
  }

```


```{r VZNIK PTU 2.0}

# L O A D

# pokud neni jiz nacten v Environmentu

interni_adresar <- read.table(paste0(path_csv, "_NM-HM_INTERNI_ADRESAR.csv"),
                        header = T, sep = ";", fileEncoding="cp1250")

# M O D I F Y

dopr_tab <- sbirky %>% 
  select(MINVC, Autor_S, Role_S, Datace_S, MistoVz_S) %>% 
  mutate(MDATACE = Datace_S) %>% 
  # ?
  mutate(MDAT_QM = ifelse(MDATACE == "?", MDATACE, NA)) %>% 
  # priznak snad   
  mutate(MSNAD = ifelse(str_detect(MDATACE, "^\\?"), "0", 
                        ifelse(str_detect(MDATACE, "\\?$"), "1", "0"))) %>% 
  mutate(MDATACE = ifelse(str_detect(MDATACE, "\\?$"),
                          str_replace(MDATACE, "\\?", ""), MDATACE)) %>% 
  # yyyy
  mutate(MDAT_Y = ifelse(str_detect(MDATACE, "_00_00"),
                         str_replace_all(MDATACE, "_00|-00", ""), NA)) %>% 
  # mm.yyyy
  # mutate(MDAT_YM = ifelse(str_detect(MDATACE,
  #                                    "^([0-9]{4})[_]([0-9]{1})([1-9]{1})[_]00$"),
  #                                   # format(anydate(substring(MDATACE, 1, 7), "%m.%Y")), ""))
  #                                   # substring(format(anydate(MDATACE), "%m.%Y"), 1, 7), ""))
  #                                   format(anydate(MDATACE), "%m.%Y"), ""))
  # mutate(MDAT_YM = format(anydate(MDATACE), "%m.%Y")) %>%
  mutate(MDAT_YM = substring(ifelse(str_detect(MDATACE,
                                             "^([0-9]{4})[_]([0-9]{1})([1-9]{1})[_]00$"),
                                  MDATACE, ""), 1, 7)) %>%
  mutate(MDAT_YM = format(anydate(MDAT_YM), "%m.%Y")) %>%
  
  # dd.mm.yyyy
  mutate(MDAT_YMD = ifelse(str_detect(MDATACE,
                          "^([0-9]{4})[_]([0-9]{2})[_]([0-9]{2})$"), 
                           format(anydate(MDATACE), "%d.%m.%Y"), NA)) %>% 
  
  # yy leta ss stoleti
  mutate(MDAT_LETA = ifelse(str_detect(MDATACE, "^([0-9]{4})[_]XX[_]([0-9]{2})$"),
                                    paste0(substring(MDATACE, 9, 9), "0. léta ",
                                           substring(MDATACE, 3, 4), ". století"), NA)) %>% 
  # poloviny
  mutate(MDAT_2 = ifelse(str_detect(MDATACE, "^00\\d\\d[_]\\d2[_]XX"),
                                    paste0(substring(MDATACE, 6, 6), ". polovina ",
                                           substring(MDATACE, 3, 4), ". století"), NA)) %>%
  # tretiny - NEVYSKYTUJE SE
  mutate(MDAT_3 = ifelse(str_detect(MDATACE, "^00\\d\\d[_]\\d3[_]XX"),
                                    paste0(substring(MDATACE, 6, 6), ". třetina ",
                                           substring(MDATACE, 3, 4), ". století"), NA)) %>%
  # poloviny - NEVYSKYTUJE SE
  mutate(MDAT_4 = ifelse(str_detect(MDATACE, "^00\\d\\d[_]\\d3[_]XX"),
                                    paste0(substring(MDATACE, 6, 6), ". čtvrtina ",
                                           substring(MDATACE, 3, 4), ". století"), NA)) %>% 
  # tretina roku
  mutate(MDAT_3r = ifelse(str_detect(MDATACE, "^\\d([1-9]{2})\\d[_]\\d3[_]XX"),
                                    paste0(substring(MDATACE, 6, 6), ". třetina roku ",
                                           substring(MDATACE, 1, 4)), NA)) %>%  
  
  # DATACE FINAL
  mutate(MDATACE_MERG = coalesce(MDAT_QM, MDAT_Y, MDAT_YM, MDAT_YMD, MDAT_LETA, MDAT_2, MDAT_3r)) %>% 
  mutate(MDATACE_FIN = coalesce(MDATACE_MERG, MDATACE)) %>% 
  select(-c(MDAT_QM, MDAT_Y, MDAT_YM, MDAT_YMD, MDAT_LETA, MDAT_2, MDAT_3, MDAT_4, MDAT_3r,
            Datace_S, MDATACE, MDATACE_MERG)) 
  

# join interni adresar to deal with new name codes

dopr_tab2 <- merge(dopr_tab, interni_adresar, by.x = "Autor_S", by.y = "puvkod", 
                   all.x = T, keep = T) %>% 
  mutate('3$autorSubjektKod' = ifelse(Autor_S == "neznámý", "neznámý", novykod))

# join all three sections with the order numbering

autori <- dopr_tab2 %>% 
  filter(! is.na(Autor_S)) %>% 
  # select(MINVC, Role_S, '3$autorSubjektKod') %>% 
  mutate(MPORADI = "1", 
         MDATACE_FIN = NA,
         MistoVz_S = NA, 
         MSNAD = NA)

datace <- dopr_tab2 %>% 
  filter(! is.na(MDATACE_FIN)) %>% 
  # select(MINVC, MSNAD, MDATACE_FIN) %>% 
  mutate(MPORADI = "2",
         '3$autorSubjektKod' = NA,
         MistoVz_S = NA, 
         Role_S = NA)

misto <- dopr_tab2 %>% 
  filter(! is.na(MistoVz_S)) %>% 
  # select(MINVC, MistoVz_S) %>% 
  mutate(MPORADI = "3",
         '3$autorSubjektKod' = NA,
         MDATACE_FIN = NA, 
         Role_S = NA, 
         MSNAD = NA)

modify_tab <- autori %>% 
  rbind(datace) %>% 
  rbind(misto) %>% 
  mutate(MEMPTY = "")

modif_save <- paste0(path_csv, spravce, "_modif_vznikPtu.csv")

if(file.exists(modif_save)){
  print("You've been here before!")
} else {
  write.table(modify_tab, file = modif_save, 
            sep = ";", quote = T, row.names = F, 
            na = "", fileEncoding="cp1250")
  print("Operational file  S A V E D,  my dear!")
  }

# C R E A T E    C S V

mus_tab <- modify_tab %>% 
  select(
    '1SPCislo' = MINVC,                          # !! povinne !!
    '2poradi' = MPORADI,                         # !! povinne !!
    '3$autorSubjektKod' = '3$autorSubjektKod',             
    '4autorSnad' = MEMPTY,                       # priznak 0 1                        
    '5autorRoleNazev' = Role_S,          
    '6autorPoznamka' = MEMPTY, 
    '7mistoLokalitaNazev' = MistoVz_S, 
    '8mistoSnad' = MEMPTY,                       # priznak 0 1 
    '9specifikaceMistaNazev' = MEMPTY, 
    '10mistoDoplneni' = MEMPTY, 
    '11dataceHodnota' = MDATACE_FIN, 
    '12datacePoznamka' = MEMPTY, 
    '13poznamka' = MEMPTY, 
    '14kvalifikatorDatace' = MEMPTY, 
    '15dataceSnad' = MSNAD,                      # priznak 0 1 
    '16kvalifikatorDatace2' = MEMPTY,  
    '17dataceSnad' = MEMPTY)                     # priznak 0 1  

oper_vznikPtu <- mus_tab

# S A V E   I M P O R T   C S V

save <- paste0(path_csv, spravce, "_import_vznikPtu.csv")

if(file.exists(save)){
  print("You've been here before!")
} else {
  write.table(mus_tab, file = save, 
            sep = ";", quote = T, row.names = F, 
            na = "", fileEncoding="cp1250")
  print("Import written, baby!")
  }

```


## Manipulace

**DEMUS**: Manipulace  
**MUSEION**: import_manipulace.csv

**IMPORTNÍ ROZHRANNÍ**: CSV Položka dokladu inventarizace


- nejsou k dispozici zadne doklady o manipulaci  
- je treba je rucne zalozit v Museionu  


```{r TABLE MANIPULACE}

# L O A D

demus_tab <- read_excel(paste0(path_data, "Manipulace.xlsx")) %>% 
  filter(!is.na(Stav_MN)) # odtraneni duplicitnich radku se stejnym datem, bez uvedeneho stavu -> prazdny radek, omyl

# M O D I F Y

modify_tab <- merge(sb, demus_tab, by.x = "IdC_S", by.y = "IdC_MN", 
                   all.y = T, keep = T) %>% 
   mutate(MEMPTY = "",
          '1cislo' = case_when(str_detect(DatMan_MN, "2017") ~ "99/2017",
                              str_detect(DatMan_MN, "2018") ~ "99/2018",
                              str_detect(DatMan_MN, "2019") ~ "99/2019"),
          '2sbirkaCisloEvidInt' = sbirka,  
          '3podsbirkaCislo' = podsbirka, 
          '10zapsal' = "import")

modif_save <- paste0(path_csv, spravce, "_modif_manipulace.csv")

if(file.exists(modif_save)){
  print("You've been here before!")
} else {
  write.table(modify_tab, file = modif_save, 
            sep = ";", quote = T, row.names = F, 
            na = "", fileEncoding="cp1250")
  print("Operational file  S A V E D,  my dear!")
  }

# C R E A T E    C S V

mus_tab <- modify_tab %>% 
  select(
    '1cislo' = '1cislo',                               # !! povinne !!
    '2sbirkaCisloEvidInt' = '2sbirkaCisloEvidInt',     # !! povinne !!
    '3podsbirkaCislo' = '3podsbirkaCislo',           # !! povinne !!          
    '4SPCislo' = MINVC,                                # !! povinne !!            
    '5prirustekCislo' = MEMPTY,          
    '6prirustekPoradi' = MEMPTY, 
    '7stavNazev' = Stav_MN,                            # !! povinne !!
    '8popisStavu' = PopisSt_MN,                       
    '9datum' = DatMan_MN,                              # !! povinne !!
    '10zapsal' = '10zapsal',                           # !! povinne !!
    '11nalezen' = MEMPTY, 
    '12zasahKR' = MEMPTY, 
    '13upravaKarty' = MEMPTY, 
    '14poznamka' = MEMPTY 
    )                    

oper_vznikPtu <- mus_tab

# S A V E   I M P O R T   C S V

save <- paste0(path_csv, spravce, "_import_manipulace.csv")

if(file.exists(save)){
  print("You've been here before!")
} else {
  write.table(mus_tab, file = save, 
            sep = ";", quote = T, row.names = F, 
            na = "", fileEncoding="cp1250")
  print("Import written, baby!")
  }

```


# p i s k o v i s t e

### mista vzniku

- zkontrolovat Místa vzniku a chybějící doplnit do Lokalit

```{r CHECK LOCS DICTIONARY, eval = F}

unique(oper_lokalita$'1lokalitaNazev')
unique(sbirky$MistoVz_S)

vec <- setdiff(sbirky$MistoVz_S, oper_lokalita$'1lokalitaNazev')

mvzn_tab <- as.data.frame(vec) %>%  # '1lokalitaNazev'
  add_column('2okresNazev'= "") %>% 
  add_column('3statKod'= "") %>% 
  add_column('4oblastNazev'= "") %>% 
  add_column('5lokalitaZeme'= "") %>% 
  add_column('6lokalitaCtverec'= "") %>% 
  add_column('7lokalitaMapa'= "") %>% 
  add_column('8lokalitaZemepisnaSirka'= "") %>% 
  add_column('9lokalitaZemepisnaDelka'= "") %>% 
  add_column('10lokalitaNadmorskaVyska'= "") %>% 
  add_column('11lokalitaPoznamka'= "") %>% 
  add_column('12lokalitaSbirka'= "") %>% 
  add_column('13lokalitaPodsbirka'= "") %>%  
  add_column('14fytochorion1'= "") %>%  
  add_column('15lokalitaPublicNadNazev'= "") %>%  
  add_column('16lokalitaPublicNazev'= "") %>%  
  add_column('17fytochorion2'= "") %>%  
  add_column('18fytochorion3'= "") %>%  
  add_column('19fytochorion4'= "")
  
colnames(mvzn_tab)[1] <- '1lokalitaNazev'

# SAVE IMPORT FILE

save <- paste0(path_csv, spravce, "_import_lokalita_mistvzn.csv")

if(file.exists(save)){
  print("You've been here before!")
} else {
  write.table(mvzn, file = save, 
            sep = ";", quote = T, row.names = F, 
            na = "", fileEncoding="cp1250")
  print("Import written, baby!")
  }

```

